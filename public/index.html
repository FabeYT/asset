<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ETK-Asset Management</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="shortcut icon" href="Bilder/klecks-256x256.png" type="image/x-icon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    /* Ihr gesamter CSS-Code bleibt unverändert */
:root {
--primary: #FF7700;
--primary-dark: #E06A00;
--primary-light: #FF9838;
--primary-extra-light: #FFF0E5;
--light: #FFFFFF;
--light-grey: #F8F9FC;
--grey: #EFF2F7;
--text-dark: #2D3748;
--text-light: #718096;
--border: #E2E8F0;
--success: #48BB78;
--warning: #ECC94B;
--danger: #F56565;
--info: #4299E1;
--sidebar-width: 260px;
--header-height: 70px;
--border-radius: 12px;
--transition: all 0.3s ease;
--shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
--card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
--bg-color: #F8F9FC;
--card-bg: #FFFFFF;
--text-color: #2D3748;
--text-light-color: #718096;
--dark-red: #8B0000; /* Dunkelrot für Defekt */
--purple: #9F7AEA; /* Lila für Ausgemustert */
}

[data-theme="dark"] {
--bg-color: #1A202C;
--card-bg: #2D3748;
--text-color: #E2E8F0;
--text-light-color: #A0AEC0;
--light-grey: #2D3748;
--grey: #4A5568;
--border: #4A5568;
--primary-extra-light: #4A5568;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Poppins', sans-serif;
}

body {
background-color: var(--bg-color);
color: var(--text-color);
min-height: 100vh;
display: flex;
overflow-x: hidden;
}

.ip-status.free {
background-color: var(--success);
color: white;
}

/* Moderner Ladebildschirm */
.loading-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, var(--primary), var(--primary-light));
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
z-index: 10000;
transition: all 0.8s ease;
}

.loading-overlay.hidden {
opacity: 0;
visibility: hidden;
transform: scale(1.1);
}

.loading-logo {
display: flex;
align-items: center;
gap: 20px;
margin-bottom: 40px;
animation: pulseGlow 2s ease-in-out infinite alternate;
}

.loading-logo-icon {
width: 60px;
height: 60px;
background: rgba(255, 255, 255, 0.2);
border-radius: 15px;
display: flex;
align-items: center;
justify-content: center;
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.3);
}

.loading-logo-icon i {
font-size: 30px;
color: white;
}

.loading-logo-text {
font-size: 28px;
font-weight: 700;
color: white;
text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.loading-spinner {
position: relative;
width: 80px;
height: 80px;
margin-bottom: 30px;
}

.loading-spinner::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
border: 4px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s linear infinite;
}

.loading-spinner::after {
content: '';
position: absolute;
top: 10px;
left: 10px;
width: calc(100% - 20px);
height: calc(100% - 20px);
border: 2px solid rgba(255, 255, 255, 0.2);
border-radius: 50%;
border-bottom-color: white;
animation: spin 1.5s linear infinite reverse;
}

.loading-text {
color: white;
font-size: 18px;
font-weight: 500;
margin-bottom: 10px;
animation: fadeInOut 1.5s ease-in-out infinite alternate;
}

.loading-progress {
width: 300px;
height: 6px;
background: rgba(255, 255, 255, 0.2);
border-radius: 3px;
overflow: hidden;
margin-bottom: 20px;
}

.loading-progress-bar {
height: 100%;
background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), white, rgba(255, 255, 255, 0.8));
border-radius: 3px;
width: 0%;
transition: width 0.3s ease;
animation: shimmer 2s ease-in-out infinite;
}

.loading-dots {
display: flex;
gap: 8px;
}

.loading-dot {
width: 8px;
height: 8px;
background: white;
border-radius: 50%;
animation: bounce 1.4s ease-in-out infinite both;
}

.loading-dot:nth-child(1) { animation-delay: -0.32s; }
.loading-dot:nth-child(2) { animation-delay: -0.16s; }
.loading-dot:nth-child(3) { animation-delay: 0s; }

@keyframes spin {
to { transform: rotate(360deg); }
}

@keyframes pulseGlow {
0% { transform: scale(1); filter: brightness(1); }
100% { transform: scale(1.05); filter: brightness(1.2); }
}

@keyframes fadeInOut {
0% { opacity: 0.6; }
100% { opacity: 1; }
}

@keyframes shimmer {
0% { background-position: -300px 0; }
100% { background-position: 300px 0; }
}

@keyframes bounce {
0%, 80%, 100% {
transform: scale(0.6);
opacity: 0.5;
}
40% {
transform: scale(1);
opacity: 1;
}
}

/* Sidebar Styles */
.sidebar {
width: var(--sidebar-width);
background: var(--card-bg);
height: 100vh;
position: fixed;
left: 0;
top: 0;
padding: 20px 0;
box-shadow: var(--shadow);
z-index: 100;
transition: var(--transition);
display: flex;
flex-direction: column;
}

.sidebar-header {
padding: 0 20px 20px;
border-bottom: 1px solid var(--border);
margin-bottom: 20px;
}

.logo {
display: flex;
align-items: center;
gap: 15px;
}

.logo-icon {
width: 40px;
height: 40px;
background: white;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
}

.logo-icon i {
font-size: 20px;
color: white;
}

.logo-text {
font-size: 20px;
font-weight: 700;
color: var(--primary);
}

.sidebar-menu {
flex: 1;
overflow-y: auto;
padding: 0 10px;
}

.menu-item {
display: flex;
align-items: center;
padding: 12px 20px;
margin: 5px 0;
border-radius: 10px;
color: var(--text-light-color);
text-decoration: none;
transition: var(--transition);
font-weight: 500;
}

.menu-item:hover, .menu-item.active {
background-color: var(--primary-extra-light);
color: var(--primary);
}

.menu-item i {
margin-right: 12px;
font-size: 18px;
}

.menu-label {
padding: 10px 20px;
font-size: 12px;
text-transform: uppercase;
color: var(--text-light-color);
letter-spacing: 1px;
margin-top: 20px;
}

.sidebar-footer {
padding: 20px;
border-top: 1px solid var(--border);
font-size: 12px;
color: var(--text-light-color);
text-align: center;
display: flex;
flex-direction: column;
gap: 15px;
}

.download-btn {
background: var(--primary);
color: white;
border: none;
padding: 12px 20px;
border-radius: 8px;
cursor: pointer;
transition: var(--transition);
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
font-weight: 500;
text-decoration: none;
}

.download-btn:hover {
background: var(--primary-dark);
}

/* Main Content */
.main-content {
flex: 1;
margin-left: var(--sidebar-width);
padding: 20px;
transition: var(--transition);
}

/* Header */
.header {
background: var(--card-bg);
height: var(--header-height);
display: flex;
align-items: center;
justify-content: space-between;
padding: 0 30px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
margin-bottom: 30px;
}

.page-title {
font-size: 24px;
font-weight: 600;
color: var(--text-color);
}

.header-actions {
display: flex;
align-items: center;
gap: 20px;
}

.header-info {
display: flex;
align-items: center;
gap: 10px;
color: var(--text-light-color);
font-size: 14px;
flex-wrap: wrap;
}

.header-info i {
color: var(--primary);
}

/* Dashboard Section */
.dashboard-section {
display: none;
animation: fadeIn 0.5s ease;
}

.dashboard-section.active {
display: block;
}

/* Stats Cards */
.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
gap: 20px;
margin-bottom: 30px;
}

.stat-card {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 25px;
display: flex;
flex-direction: column;
box-shadow: var(--card-shadow);
transition: var(--transition);
position: relative;
overflow: hidden;
}

.stat-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 5px;
height: 100%;
background: var(--primary);
}

.stat-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
}

.stat-icon {
width: 50px;
height: 50px;
background: var(--primary-extra-light);
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 15px;
}

.stat-icon i {
font-size: 24px;
color: var(--primary);
}

.stat-value {
font-size: 32px;
font-weight: 700;
margin: 5px 0;
color: var(--text-color);
}

.stat-label {
color: var(--text-light-color);
font-size: 14px;
}

/* Charts/Additional Stats */
.charts-container {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin-bottom: 30px;
}

.chart-card {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 25px;
box-shadow: var(--card-shadow);
position: relative;
}

.chart-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.chart-title {
font-size: 18px;
font-weight: 600;
color: var(--text-color);
}

.chart-container {
position: relative;
height: 250px;
width: 100%;
}

/* Devices Table */
.table-container {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 25px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}

.table-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.table-title {
font-size: 20px;
font-weight: 600;
color: var(--text-color);
}

.table-controls {
display: flex;
gap: 10px;
flex-wrap: wrap;
}

.btn {
background: var(--primary);
color: white;
border: none;
padding: 10px 20px;
border-radius: 8px;
cursor: pointer;
transition: var(--transition);
display: flex;
align-items: center;
gap: 8px;
font-weight: 500;
white-space: nowrap;
}

.btn:hover {
background: var(--primary-dark);
}

.btn-outline {
background: transparent;
color: var(--primary);
border: 1px solid var(--primary);
}

.btn-outline:hover {
background: var(--primary-extra-light);
}

/* Table Styles */
.devices-table {
width: 100%;
border-collapse: collapse;
}

.devices-table th {
text-align: left;
padding: 15px;
color: var(--text-light-color);
font-weight: 600;
border-bottom: 1px solid var(--border);
}

.devices-table td {
padding: 15px;
border-bottom: 1px solid var(--border);
color: var(--text-color);
}

.devices-table tbody tr {
transition: var(--transition);
cursor: pointer;
}

.devices-table tbody tr:hover {
background: var(--primary-extra-light);
}

/* --- MODAL & GERÄTEDETAILS (AKTUALISIERT) --- */

/* Angepasstes Modal für volle Sichtbarkeit ohne Scrollen */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    padding: 20px; /* Mehr Padding für bessere Darstellung */
}

.modal-overlay.active {
opacity: 1;
visibility: visible;
}

.modal {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 1600px; /* Kleinere maximale Breite */
    max-height: 90vh;
    overflow: hidden; /* Verhindert Scrollen im Modal */
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: translateY(20px);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
}

.modal-overlay.active .modal {
    transform: translateY(0);
}

.modal-header {
padding: 25px 30px;
border-bottom: 1px solid var(--border);
display: flex;
justify-content: space-between;
align-items: center;
}

.modal-title {
font-size: 22px;
font-weight: 600;
color: var(--text-color);
}

.modal-close {
background: none;
border: none;
font-size:24px;
cursor: pointer;
color: var(--text-light-color);
transition: var(--transition);
}

.modal-close:hover {
color: var(--text-color);
}

.modal-body {
padding: 30px;
overflow-y: auto;
max-height: calc(90vh - 160px); /* Maximale Höhe des Inhaltsbereichs */
}

/* Modernes Gerätedetail-Layout */
.device-details-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.device-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-radius: var(--border-radius);
    color: white;
    box-shadow: var(--card-shadow);
}

.device-title h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
}

.device-subtitle {
    font-size: 16px;
    opacity: 0.9;
    margin-top: 5px;
}

.device-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
}

.status-available {
    background-color: var(--success);
    color: white;
}

.status-active {
    background-color: var(--danger);
    color: white;
}

.status-error {
    background-color: var(--dark-red);
    color: white;
}

.status-warning {
    background-color: var(--warning);
    color: white;
}

.status-retired {
    background-color: var(--purple);
    color: white;
}

.status-unknown {
    background-color: #f5f5f5;
    color: #9e9e9e;
}

.device-tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
}

.tab-button {
    background: none;
    border: none;
    padding: 12px 20px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-light-color);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: var(--transition);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
}

.tab-button:hover {
    color: var(--primary);
}

.tab-button.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.tab-button i {
    font-size: 16px;
}

.device-tabs-content {
    flex: 1;
    overflow-y: auto;
    max-height: 500px;
}

.tab-pane {
    display: none;
    padding: 20px;
}

.tab-pane.active {
    display: block;
}

.tab-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.detail-section {
    background: var(--light-grey);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--card-shadow);
}

.detail-section-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.detail-section-title i {
    color: var(--primary);
}

.detail-table {
    width: 100%;
    border-collapse: collapse;
}

.detail-table td {
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
}

.detail-table .detail-label {
    font-weight: 500;
    color: var(--text-light-color);
    width: 40%;
}

.detail-table .detail-value {
    color: var(--text-color);
    font-weight: 500;
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.detail-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.detail-item .detail-label {
    font-size: 12px;
    color: var(--text-light-color);
    font-weight: 500;
}

.detail-item .detail-value {
    font-size: 14px;
    color: var(--text-color);
    font-weight: 500;
}

/* GPU Cards */
.gpu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.gpu-card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--card-shadow);
    border-left: 4px solid var(--primary);
}

.gpu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.gpu-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}

.gpu-type {
    font-size: 12px;
    color: var(--text-light-color);
    background: var(--primary-extra-light);
    padding: 4px 8px;
    border-radius: 4px;
}

.gpu-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

.gpu-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* Drive Cards */
.drives-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.drive-card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--card-shadow);
    border-left: 4px solid var(--info);
}

.drive-card.cloud-drive {
    border-left-color: var(--primary);
}

.drive-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.drive-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}

.drive-type {
    font-size: 12px;
    color: var(--text-light-color);
    background: var(--info-extra-light);
    padding: 4px 8px;
    border-radius: 4px;
}

.drive-usage {
    margin-bottom: 15px;
}

.usage-bar {
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 5px;
}

.usage-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
}

.usage-text {
    font-size: 12px;
    color: var(--text-light-color);
}

.drive-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

.drive-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* Network Cards */
.network-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}

.network-card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--card-shadow);
    border-left: 4px solid var(--info);
}

.network-card.active {
    border-left-color: var(--success);
}

.network-card.inactive {
    border-left-color: var(--text-light-color);
}

.network-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.network-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}

.network-status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: 500;
}

.network-status.connected {
    color: var(--success);
}

.network-status.disconnected {
    color: var(--text-light-color);
}

.network-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

.network-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* No Data State */
.no-data {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    text-align: center;
    color: var(--text-light-color);
}

.no-data i {
    font-size: 48px;
    margin-bottom: 15px;
    color: var(--text-light-color);
}

.no-data h3 {
    margin: 0 0 10px 0;
    color: var(--text-color);
}

.no-data p {
    margin: 0;
    color: var(--text-light-color);
}

/* Modal Footer */
.modal-footer {
padding: 20px 30px;
border-top: 1px solid var(--border);
display: flex;
justify-content: space-between;
gap: 15px;
}

.modal-footer .btn {
flex: 1;
}

/* --- RESPONSIVE ANPASSUNGEN FÜR DAS MODAL --- */

@media (max-width: 768px) {
    .modal {
        width: 95%;
        max-height: 95vh;
    }

    .modal-header {
        padding: 20px;
    }

    .modal-body {
        padding: 20px;
    }

    .device-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }

    .device-tabs {
        flex-wrap: wrap;
    }

    .tab-button {
        flex: 1;
        min-width: 120px;
        justify-content: center;
    }

    .tab-pane {
        padding: 15px;
    }

    .detail-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .gpu-grid {
        grid-template-columns: 1fr;
    }

    .drives-grid {
        grid-template-columns: 1fr;
    }

    .network-grid {
        grid-template-columns: 1fr;
    }

    .gpu-details {
        grid-template-columns: 1fr;
    }

    .drive-details {
        grid-template-columns: 1fr;
    }

    .network-details {
        grid-template-columns: 1fr;
    }

    .modal-footer {
        flex-direction: column;
        padding: 15px 20px;
    }
}

/* IP Addresses Section - Modernisiert */
.ip-section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
flex-wrap: wrap;
gap: 15px;
}

.ip-header-actions {
display: flex;
gap: 15px;
align-items: center;
flex-wrap: wrap;
}

.ip-stats {
display: flex;
gap: 20px;
margin-bottom: 20px;
flex-wrap: wrap;
}

.ip-stat-card {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 20px;
box-shadow: var(--card-shadow);
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
min-width: 180px;
}

.ip-stat-value {
font-size: 28px;
font-weight: 700;
color: var(--primary);
margin-bottom: 5px;
}

.ip-stat-label {
color: var(--text-light-color);
font-size: 14px;
}

.search-container {
position: relative;
width: 300px;
}

.search-input {
width: 100%;
padding: 12px 20px 12px 45px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--card-bg);
color: var(--text-color);
font-size: 14px;
transition: var(--transition);
}

.search-input:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(255, 119, 0, 0.1);
}

.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--text-light-color);
}

.ip-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
gap: 10px;
}

.ip-card {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 20px;
box-shadow: var(--card-shadow);
transition: var(--transition);
border-left: 4px solid var(--primary);
}

.ip-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.ip-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.ip-address {
font-size: 18px;
font-weight: 600;
color: var(--primary);
}

.ip-status {
display: flex;
align-items: center;
font-size: 12px;
padding: 4px 10px;
border-radius: 20px;
background: var(--primary-extra-light);
color: var(--primary);
}

.ip-details {
display: flex;
flex-direction: column;
gap: 10px;
}

.ip-detail-item {
display: flex;
justify-content: space-between;
padding: 8px 0;
border-bottom: 1px solid var(--border);
}

.ip-detail-item:last-child {
border-bottom: none;
}

.ip-detail-label {
color: var(--text-light-color);
font-weight: 500;
font-size:small;
}

.ip-detail-value {
color: var(--text-color);
font-weight: 500;
font-size:small;
}

.free-ip-card {
border-left-color: var(--success);
}

.free-ip-card .ip-address {
color: var(--success);
}

/* Settings Section */
.settings-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 20px;
}

.settings-card {
background: var(--card-bg);
border-radius: var(--border-radius);
overflow: hidden;
box-shadow: var(--card-shadow);
transition: var(--transition);
}

.settings-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.settings-card-header {
display: flex;
align-items: center;
padding: 20px;
background: var(--primary-extra-light);
border-bottom: 1px solid var(--border);
gap: 12px;
}

.settings-card-header i {
font-size: 20px;
color: var(--primary);
width: 24px;
}

.settings-card-header h3 {
font-size: 18px;
font-weight: 600;
color: var(--text-color);
margin: 0;
}

.settings-card-body {
padding: 20px;
}

.setting-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px 0;
border-bottom: 1px solid var(--border);
}

.setting-item:last-child {
border-bottom: none;
}

.setting-info {
display: flex;
flex-direction: column;
flex: 1;
}

.setting-label {
font-weight: 500;
color: var(--text-color);
margin-bottom: 4px;
}

.setting-description {
font-size: 12px;
color: var(--text-light-color);
}

.settings-action-btn {
display: flex;
align-items: center;
gap: 12px;
width: 100%;
padding: 12px;
margin-bottom: 10px;
background: var(--light-grey);
border: 1px solid var(--border);
border-radius: 8px;
color: var(--text-color);
cursor: pointer;
transition: var(--transition);
}

.settings-action-btn:hover {
background: var(--primary-extra-light);
border-color: var(--primary-light);
}

.settings-action-btn:last-child {
margin-bottom: 0;
}

.settings-action-btn i {
color: var(--primary);
width: 20px;
}

.info-item {
display: flex;
justify-content: space-between;
padding: 10px 0;
border-bottom: 1px solid var(--border);
}

.info-item:last-child {
border-bottom: none;
}

.info-label {
color: var(--text-light-color);
font-weight: 500;
}

.info-value {
color: var(--text-color);
font-weight: 600;
}

/* Responsive Design für Einstellungen */
@media (max-width: 768px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }

    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    .setting-item .switch,
    .setting-item .select-input {
        align-self: flex-end;
    }
}

.settings-card-title {
font-size: 18px;
font-weight: 600;
margin-bottom: 20px;
color: var(--text-color);
display: flex;
align-items: center;
gap: 10px;
}

.settings-card-title i {
color: var(--primary);
}

.settings-group {
margin-bottom: 20px;
}

.settings-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 12px 0;
border-bottom: 1px solid var(--border);
min-height: 50px;
}

.settings-label {
color: var(--text-color);
font-weight: 500;
}

.settings-description {
font-size: 12px;
color: var(--text-light-color);
margin-top: 5px;
}

.switch {
position: relative;
display: inline-block;
width: 52px;
height: 26px;
}

.switch input {
opacity: 0;
width: 0;
height: 0;
}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: var(--grey);
transition: .4s;
border-radius: 34px;
}

.slider:before {
position: absolute;
content: "";
height: 22px;
width: 22px;
left: 2px;
bottom: 2px;
background-color: white;
transition: .4s;
border-radius: 50%;
}

input:checked + .slider {
background-color: var(--primary);
}

input:checked + .slider:before {
transform: translateX(26px);
}

@media (min-width: 1600px) {
.switch {
width: 60px;
height: 30px;
}

.slider:before {
height: 26px;
width: 26px;
left: 2px;
bottom: 2px;
}

input:checked + .slider:before {
transform: translateX(30px);
}
}

.select-input {
padding: 6px 10px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--card-bg);
color: var(--text-color);
min-width: 100px;
font-size: 0.9rem;
transition: border-color 0.2s, box-shadow 0.2s;
}

.select-input1 {
padding: 6px 10px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--card-bg);
color: var(--text-color);
min-width: 100px;
margin-top: 40px;
margin-left: -20px;
font-size: 0.9rem;
transition: border-color 0.2s, box-shadow 0.2s;
}

/* Console Section */
.console-container {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 25px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}

.console-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
flex-wrap: wrap;
gap: 15px;
}

.console-title {
font-size: 20px;
font-weight: 600;
color: var(--text-color);
}

.console-content {
background: var(--bg-color);
border-radius: 8px;
padding: 15px;
height: 400px;
overflow-y: auto;
font-family: monospace;
font-size: 14px;
color: var(--text-color);
line-height: 1.5;
}

.console-message {
margin-bottom: 8px;
padding: 5px 0;
}

.console-timestamp {
color: var(--text-light-color);
margin-right: 10px;
}

.console-info {
color: var(--info);
}

.console-warning {
color: var(--warning);
}

.console-error {
color: var(--danger);
}

.console-success {
color: var(--success);
}

.console-controls {
display: flex;
gap: 10px;
margin-top: 15px;
}

/* IP Pool Section */
.ip-pool-section {
margin-bottom: 30px;
}

.ip-pool-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.ip-pool-title {
font-size: 18px;
font-weight: 600;
color: var(--text-color);
}

.ip-pool-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 15px;
}

.ip-pool-card {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 20px;
box-shadow: var(--card-shadow);
border-left: 4px solid var(--info);
}

.ip-pool-range {
font-size: 16px;
font-weight: 600;
color: var(--info);
margin-bottom: 10px;
}

.ip-pool-stats {
display: flex;
justify-content: space-between;
margin-top: 15px;
padding-top: 15px;
border-top: 1px solid var(--border);
}

.ip-pool-stat {
text-align: center;
}

.ip-pool-stat-value {
font-size: 18px;
font-weight: 700;
}

.ip-pool-stat-label {
font-size: 12px;
color: var(--text-light-color);
}

/* Animations */
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

@keyframes fadeInUp {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

/* Responsive Design */
@media (max-width: 992px) {
    .charts-container {
        grid-template-columns: 1fr;
    }

    .ip-section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }

    .search-container {
        width: 100%;
    }

    .ip-stats {
        flex-direction: column;
    }

    .ip-header-actions {
        width: 100%;
        justify-content: space-between;
    }
}

@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }

    .sidebar.active {
        transform: translateX(0);
    }

    .main-content {
        margin-left: 0;
    }

    .menu-toggle {
        display: block;
    }

    .stats-container {
        grid-template-columns: 1fr;
    }

    .header {
        flex-direction: column;
        height: auto;
        padding: 15px;
        gap: 15px;
    }

    .header-actions {
        flex-wrap: wrap;
        justify-content: center;
    }

    .loading-logo {
        gap: 15px;
        margin-bottom: 30px;
    }

    .loading-logo-icon {
        width: 50px;
        height: 50px;
    }

    .loading-logo-icon i {
        font-size: 24px;
    }

    .loading-logo-text {
        font-size: 24px;
    }

    .loading-progress {
        width: 250px;
    }

    .detail-item {
        flex-direction: column;
        gap: 5px;
    }

    .detail-label, .detail-value {
        width: 100%;
        text-align: left;
    }

    .table-controls {
        flex-direction: column;
        align-items: flex-start;
    }

    .ip-header-actions {
        flex-direction: column;
        align-items: flex-start;
    }

    .search-container {
        width: 100%;
    }
}

/* Period Selector Styles */
.stat-period-selector {
    margin-top: 10px;
}

.stat-period-selector select {
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid var(--border);
    background: var(--card-bg);
    color: var(--text-color);
    font-size: 12px;
}

/* Utility Classes */
.menu-toggle {
display: none;
background: none;
border: none;
font-size: 24px;
color: var(--text-color);
cursor: pointer;
}

.text-primary {
color: var(--primary);
}

.section-title {
font-size: 22px;
font-weight: 600;
margin-bottom: 20px;
color: var(--text-color);
}

.fade-in {
animation: fadeIn 0.5s ease;
}

.slide-in {
animation: fadeInUp 0.5s ease;
}

.loading {
text-align: center;
padding: 2rem;
color: var(--text-light-color);
}

.error-message {
text-align: center;
padding: 2rem;
color: #d32f2f;
background-color: #ffebee;
border-radius: 8px;
}

.error-message i {
margin-right: 8px;
}

.devices-table tbody tr {
cursor: pointer;
transition: background-color 0.2s ease;
}

.devices-table tbody tr:hover {
background-color: var(--primary-extra-light);
}

.filter-container {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 20px;
box-shadow: var(--card-shadow);
margin-bottom: 20px;
display: none;
}

.filter-container.active {
display: block;
animation: fadeIn 0.3s ease;
}

.filter-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.filter-title {
font-size: 18px;
font-weight: 600;
color: var(--text-color);
}

.filter-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
gap: 15px;
}

.filter-group {
display: flex;
flex-direction: column;
}

.filter-label {
font-size: 14px;
margin-bottom: 8px;
color: var(--text-color);
font-weight: 500;
}

.filter-select, .filter-input {
padding: 10px 12px;
border: 1px solid var(--border);
border-radius: 8px;
background: var(--card-bg);
color: var(--text-color);
font-size: 14px;
}

.filter-actions {
display: flex;
justify-content: flex-end;
gap: 10px;
margin-top: 15px;
padding-top: 15px;
border-top: 1px solid var(--border);
}

.filter-badge {
display: inline-flex;
align-items: center;
background: var(--primary-extra-light);
color: var(--primary);
padding: 5px 10px;
border-radius: 20px;
font-size: 12px;
margin-right: 8px;
margin-bottom: 8px;
}

.filter-badge i {
margin-left: 5px;
cursor: pointer;
}

.active-filters {
margin-bottom: 15px;
}

.pagination {
display: flex;
justify-content: center;
margin-top: 20px;
gap: 10px;
}

.pagination button {
padding: 8px 16px;
border: 1px solid var(--border);
background: var(--card-bg);
color: var(--text-color);
border-radius: 6px;
cursor: pointer;
transition: var(--transition);
}

.pagination button:hover {
background: var(--primary-extra-light);
}

.pagination button.active {
background: var(--primary);
color: white;
border-color: var(--primary);
}

.add-ip-btn {
margin-top: 20px;
}

/* Notification Styles */
.notification-container {
position: fixed;
top: 20px;
right: 20px;
z-index: 1050;
display: flex;
flex-direction: column;
gap: 10px;
}

.notification {
background: white;
border-radius: 8px;
padding: 15px 20px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
display: flex;
align-items: center;
gap: 15px;
max-width: 350px;
transform: translateX(100%);
opacity: 0;
transition: all 0.3s ease;
border-left: 4px solid var(--primary);
}

.notification.show {
transform: translateX(0);
opacity: 1;
}

.notification.hide {
transform: translateX(100%);
opacity: 0;
}

.notification.success {
border-left-color: var(--success);
}

.notification.error {
border-left-color: var(--danger);
}

.notification.warning {
border-left-color: var(--warning);
}

.notification.info {
border-left-color: var(--info);
}

.notification-icon {
font-size: 24px;
}

.notification.success .notification-icon {
color: var(--success);
}

.notification.error .notification-icon {
color: var(--danger);
}

.notification.warning .notification-icon {
color: var(--warning);
}

.notification.info .notification-icon {
color: var(--info);
}

.notification-content {
flex: 1;
}

.notification-title {
font-weight: 600;
margin-bottom: 5px;
color: var(--text-color);
}

.notification-message {
font-size: 14px;
color: var(--text-light-color);
}

.notification-close {
background: none;
border: none;
font-size: 16px;
cursor: pointer;
color: var(--text-light-color);
transition: var(--transition);
}

.notification-close:hover {
color: var(--text-color);
}

/* Console Status Indicator */
.console-status {
display: flex;
align-items: center;
gap: 8px;
font-size: 14px;
margin-top: 10px;
}

.status-indicator {
width: 10px;
height: 10px;
border-radius: 50%;
display: inline-block;
}

.status-connected {
background-color: var(--success);
}

.status-disconnected {
background-color: var(--danger);
}

.status-connecting {
background-color: var(--warning);
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0% { opacity: 1; }
50% { opacity: 0.5; }
100% { opacity: 1; }
}

.pool-content {
margin-top: 15px;
padding: 15px;
background: var(--light-grey);
border-radius: var(--border-radius);
}

.free-ips-section {
margin-top: 20px;
}

.free-ips-section h4 {
margin-bottom: 15px;
color: var(--text-color);
}

.free-ips-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
gap: 15px;
}

/* Compact Mode Styles */
.compact-mode .devices-table th,
.compact-mode .devices-table td {
padding: 10px 12px;
font-size: 13px;
}

.compact-mode .stat-card {
padding: 18px;
}

.compact-mode .stat-icon {
width: 40px;
height: 40px;
margin-bottom: 10px;
}

.compact-mode .stat-icon i {
font-size: 20px;
}

.compact-mode .stat-value {
font-size: 26px;
margin: 3px 0;
}

.compact-mode .chart-card,
.compact-mode .table-container,
.compact-mode .console-container {
padding: 20px;
}

.compact-mode .chart-header {
margin-bottom: 15px;
}

.compact-mode .console-content {
height: 300px;
padding: 12px;
font-size: 13px;
}

.compact-mode .detail-item {
padding: 8px 0;
}

.compact-mode .detail-card {
padding: 18px;
}

.compact-mode .menu-item {
padding: 10px 15px;
margin: 3px 0;
}

.compact-mode .header {
height: 60px;
padding: 0 20px;
margin-bottom: 20px;
}

.compact-mode .page-title {
font-size: 20px;
}

.compact-mode .btn {
padding: 8px 15px;
font-size: 13px;
}

.compact-mode .ip-card {
padding: 15px;
}

.compact-mode .settings-card-body {
padding: 15px;
}

.compact-mode .setting-item {
padding: 10px 0;
min-height: 45px;
}

/* Responsive Anpassungen für Compact Mode */
@media (max-width: 768px) {
    .compact-mode .stats-container {
        gap: 15px;
    }

    .compact-mode .stat-card {
        padding: 15px;
    }
}

/* Log File Management Styles */
.log-file-controls {
display: flex;
gap: 10px;
margin-top: 10px;
}

.log-file-controls button {
padding: 6px 12px;
font-size: 12px;
border-radius: 4px;
}

.log-stats {
display: flex;
justify-content: space-between;
margin-top: 10px;
padding: 8px;
background: var(--light-grey);
border-radius: 4px;
font-size: 12px;
}

.log-stats span {
color: var(--text-light-color);
}

.log-stats strong {
color: var(--text-color);
}

/* Asset Management Styles */
.asset-type-selector {
display: flex;
gap: 10px;
margin-bottom: 20px;
}

.asset-type-btn {
padding: 10px 20px;
border-radius: 8px;
background: var(--card-bg);
border: 1px solid var(--border);
color: var(--text-color);
cursor: pointer;
transition: var(--transition);
}

.asset-type-btn.active {
background: var(--primary);
color: white;
border-color: var(--primary);
}

.asset-type-btn:hover {
background: var(--primary-extra-light);
}

.asset-form-container {
display: none;
}

.asset-form-container.active {
display: block;
}

.status-badge {
display: inline-block;
padding: 4px 8px;
border-radius: 4px;
font-size: 12px;
font-weight: 500;
}

.status-available {
background-color: var(--success);
color: white;
}

.status-in-use {
background-color: var(--danger);
color: white;
}

.status-defect {
background-color: var(--dark-red);
color: white;
}

.status-repair {
background-color: var(--warning);
color: white;
}

.status-retired {
background-color: var(--purple);
color: white;
}

.history-timeline {
position: relative;
margin-left: 20px;
}

.history-timeline::before {
content: '';
position: absolute;
left: -10px;
top: 0;
bottom: 0;
width: 2px;
background-color: var(--border);
}

.history-item {
position: relative;
padding-bottom: 20px;
}

.history-item::before {
content: '';
position: absolute;
left: -14px;
top: 5px;
width: 10px;
height: 10px;
border-radius: 50%;
background-color: var(--primary);
}

.history-date {
font-size: 12px;
color: var(--text-light-color);
margin-bottom: 5px;
}

.history-content {
font-size: 14px;
color: var(--text-color);
}

.history-user {
font-size: 12px;
color: var(--primary);
font-style: italic;
}

/* Reporting Styles */
.report-container {
background: var(--card-bg);
border-radius: var(--border-radius);
padding: 25px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}

.report-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
flex-wrap: wrap;
gap: 15px;
}

.report-title {
font-size: 20px;
font-weight: 600;
color: var(--text-color);
}

.report-controls {
display: flex;
gap: 10px;
flex-wrap: wrap;
}

.report-content {
display: flex;
flex-direction: column;
gap: 20px;
}

.report-section {
background: var(--light-grey);
border-radius: var(--border-radius);
padding: 20px;
}

.report-section-title {
font-size: 18px;
font-weight: 600;
color: var(--text-color);
margin-bottom: 15px;
}

.report-table {
width: 100%;
border-collapse: collapse;
}

.report-table th {
text-align: left;
padding: 12px;
color: var(--text-light-color);
font-weight: 600;
border-bottom: 1px solid var(--border);
}

.report-table td {
padding: 12px;
border-bottom: 1px solid var(--border);
color: var(--text-color);
}

.report-chart {
height: 300px;
width: 100%;
}

.report-options {
display: flex;
flex-wrap: wrap;
gap: 15px;
margin-bottom: 20px;
}

.report-option {
display: flex;
flex-direction: column;
gap: 5px;
}

.report-option label {
font-size: 14px;
font-weight: 500;
color: var(--text-color);
}

.report-option select,
.report-option input {
padding: 8px 12px;
border-radius: 6px;
background: var(--card-bg);
color: var(--text-color);
}

.report-actions {
display: flex;
gap: 10px;
margin-top: 20px;
}

/* --- MODERN IP ADDRESS STYLES --- */

.ip-pools-grid {
    display: grid;
    grid-template-columns: 1fr; /* nur eine Spalte */
    gap: 25px;
    margin-top: 20px;
}

.ip-pool-card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid var(--border);
}

.ip-pool-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.ip-pool-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 10px;
}

.ip-pool-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
}

.ip-pool-stats-header {
    font-size: 14px;
    opacity: 0.9;
}

.ip-pool-usage-bar-container {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border);
}

.ip-pool-usage-bar {
    height: 8px;
    background-color: var(--grey);
    border-radius: 4px;
    overflow: hidden;
}

.ip-pool-usage-fill {
    height: 100%;
    background-color: var(--primary);
    transition: width 0.5s ease;
}

.ip-pool-usage-text {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-light-color);
    margin-top: 5px;
}

.ip-pool-content {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.ip-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    gap: 10px;
}

.ip-tile {
    aspect-ratio: 1 / 1;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    text-align: center;
    padding: 4px;
    overflow: hidden;
}

.ip-tile .ip-address {
    font-size: 10px;
    opacity: 0.8;
    font-weight: 400;
}

.ip-tile.used {
    background-color: var(--primary);
    color: white;
    border-color: var(--primary-dark);
}

.ip-tile.used:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(255, 119, 0, 0.3);
    z-index: 10;
}

.ip-tile.free {
    background-color: var(--light-grey);
    color: var(--text-light-color);
    border: 1px dashed var(--border);
}

.ip-tile.free:hover {
    background-color: var(--success);
    color: white;
    transform: scale(1.1);
    z-index: 10;
}

.ip-tile.hidden {
    display: none;
}

/* Responsive Anpassungen für das IP-Grid */
@media (max-width: 600px) {
    .ip-pools-grid {
        grid-template-columns: 1fr;
    }
    .ip-grid {
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    }
    .ip-tile {
        font-size: 10px;
    }
    .ip-tile .ip-address {
        font-size: 8px;
    }
}

/* Fügen Sie diese CSS-Stile zu Ihrem bestehenden Stylesheet hinzu */
.password-prompt {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 20px 0;
}

.password-icon {
    font-size: 48px;
    color: var(--danger);
    margin-bottom: 20px;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: rgba(245, 101, 101, 0.1);
}

.password-input-container {
    position: relative;
    width: 100%;
    margin: 20px 0;
}

.password-input {
    width: 100%;
    padding: 12px 45px 12px 15px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 16px;
    background-color: var(--light-grey);
    color: var(--text-color);
    transition: var(--transition);
}

.password-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(255, 119, 0, 0.1);
}

.password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: var(--text-light-color);
    transition: var(--transition);
}

.password-toggle:hover {
    color: var(--primary);
}

.password-hint {
    margin-top: 10px;
    color: var(--text-light-color);
    font-style: italic;
}


/* Zeitdiagramm-Zusammenfassung */
.chart-summary {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    padding: 10px;
    background-color: var(--light-grey);
    border-radius: 8px;
}

.summary-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.summary-label {
    font-size: 12px;
    color: var(--text-light-color);
    margin-bottom: 5px;
}

.summary-value {
    font-size: 18px;
    font-weight: 600;
    color: var(--primary);
}
</style>

</head>

<body>
<!-- Loading Screen -->
<div class="loading-overlay" id="loading-overlay">
<div class="loading-logo">
<div class="loading-logo-icon">
<img src="Bilder/klecks-256x256.png" alt="ETK-Asset Management Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 10px;">
</div>
<div class="loading-logo-text">ETK-Asset Management</div>
</div>

<div class="loading-spinner"></div>

<div class="loading-text" id="loading-text">Lade Anwendung...</div>

<div class="loading-progress">
<div class="loading-progress-bar" id="loading-progress-bar"></div>
</div>

<div class="loading-dots">
<div class="loading-dot"></div>
<div class="loading-dot"></div>
<div class="loading-dot"></div>
</div>
</div>

<!-- Notification Container -->
<div class="notification-container" id="notification-container"></div>

<!-- Sidebar -->
<aside class="sidebar">
<div class="sidebar-header">
<div class="logo">
<div class="logo-icon">
<img src="Bilder/klecks-256x256.png" alt="ETK-Asset Management Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 10px;">
</div>
<div class="logo-text">ETK-Asset</div>
</div>
</div>

<div class="sidebar-menu">
<div class="menu-label">Hauptmenü</div>
<a href="#" class="menu-item active" data-section="dashboard">
<i class="fas fa-chart-pie"></i>
<span>Dashboard</span>
</a>
<a href="#" class="menu-item" data-section="devices">
<i class="fas fa-laptop"></i>
<span>Geräteübersicht</span>
</a>
<a href="#" class="menu-item" data-section="ip-addresses">
<i class="fas fa-network-wired"></i>
<span>IP-Adressen</span>
</a>
<a href="#" class="menu-item" data-section="reports">
<i class="fas fa-chart-bar"></i>
<span>Reports</span>
</a>
<a href="#" class="menu-item" data-section="console">
<i class="fas fa-terminal"></i>
<span>Console</span>
</a>

<div class="menu-label">Einstellungen</div>
<a href="#" class="menu-item" data-section="settings">
<i class="fas fa-cog"></i>
<span>Einstellungen</span>
</a>
</div>

<div class="sidebar-footer">
<a href="#" class="download-btn" id="download-ps-script">
<i class="fas fa-download"></i>
PowerShell Script
</a>
<p>© 2025 ETK-Asset Management</p>
<p>v3.1.0</p>
</div>
</aside>

<!-- Main Content -->
<main class="main-content compact-mode">
<!-- Header -->
<div class="header">
<button class="menu-toggle">
<i class="fas fa-bars"></i>
</button>
<h1 class="page-title">Dashboard</h1>
<div class="header-actions">
<div class="header-info">
<i class="fas fa-sync-alt"></i> Echtzeit-Daten | <span id="current-time"></span>
</div>
<button class="btn btn-outline" id="refresh-data">
<i class="fas fa-sync"></i> Aktualisieren
</button>
</div>
</div>

<!-- Dashboard Section -->
<section id="dashboard" class="dashboard-section active">
<div class="stats-container">
    <div class="stat-card slide-in" style="animation-delay: 0.1s;">
        <div class="stat-icon">
            <i class="fas fa-laptop"></i>
        </div>
        <div class="stat-value" id="total-devices">0</div>
        <div class="stat-label">Aktive Geräte</div>
    </div>
    <div class="stat-card slide-in" style="animation-delay: 0.2s;">
        <div class="stat-icon" style="background-color: #D1FAE5;">
            <i class="fas fa-network-wired" style="color: #48BB78;"></i>
        </div>
        <div class="stat-value" id="available-ips">0</div>
        <div class="stat-label">Verfügbare IP-Adressen</div>
    </div>
    <div class="stat-card slide-in" style="animation-delay: 0.3s;">
        <div class="stat-icon" style="background-color: #FEE2E2;">
            <i class="fas fa-ethernet" style="color: #F56565;"></i>
        </div>
        <div class="stat-value" id="used-ips">0</div>
        <div class="stat-label">Besetzte IP-Adressen</div>
    </div>
    <div class="stat-card slide-in" style="animation-delay: 0.4s;">
        <div class="stat-icon" style="background-color: #D1FAE5;">
            <i class="fas fa-plus-circle" style="color: #48BB78;"></i>
        </div>
        <div class="stat-value" id="new-devices-week">0</div>
        <div class="stat-label">Neue Geräte (Woche)</div>
    </div>
</div>

<div class="charts-container">
<div class="chart-card fade-in">
<div class="chart-header">
<h3 class="chart-title">Hersteller</h3>
</div>
<div class="chart-container">
<canvas id="manufacturer-chart"></canvas>
</div>
</div>
<div class="chart-card fade-in">
<div class="chart-header">
<h3 class="chart-title">Gerätestatus</h3>
</div>
<div class="chart-container">
<canvas id="device-status-chart"></canvas>
</div>
</div>
</div>

<div class="charts-container">
<div class="chart-card fade-in">
<div class="chart-header">
<h3 class="chart-title">Betriebssystemverteilung</h3>
</div>
<div class="chart-container">
<canvas id="os-chart"></canvas>
</div>
</div>
<div class="chart-card fade-in">
    <div class="chart-header">
        <h3 class="chart-title">Geräte hinzugefügt in Zeiträumen</h3>
        <div class="stat-period-selector">
            <select id="time-period-select">
                <option value="24">Letzte 24 Stunden</option>
                <option value="168">Letzte Woche</option>
                <option value="720">Letzter Monat</option>
            </select>
        </div>
    </div>
    <div class="chart-container">
        <canvas id="time-chart"></canvas>
    </div>
    <div class="chart-summary" id="time-chart-summary">
        <div class="summary-item">
            <span class="summary-label">Gesamt hinzugefügt:</span>
            <span class="summary-value" id="total-added">0</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Durchschnitt pro Tag:</span>
            <span class="summary-value" id="avg-per-day">0</span>
        </div>
    </div>
</div>

<div class="table-container fade-in">
<div class="table-header">
<h2 class="table-title">Kürzlich hinzugefügte Geräte</h2>
</div>
<table class="devices-table">
<thead>
<tr>
<th>Asset-Nummer</th>
<th>Hostname</th>
<th>Hersteller</th>
<th>Benutzer</th>
<th>Status</th>
<th>Letzte Aktivität</th>
</tr>
</thead>
<tbody>
<!-- Wird dynamisch gefüllt -->
</tbody>
</table>
</div>
</section>

<!-- Devices Section -->
<section id="devices" class="dashboard-section">

<!-- Filter-Container -->
<div class="filter-container" id="filter-container">
<div class="filter-header">
<h3 class="filter-title">Filteroptionen</h3>
<button class="modal-close">&times;</button>
</div>

<div class="filter-grid">

<div class="filter-group">
<label class="filter-label">Status</label>
<select class="filter-select" id="filter-status">
<option value="">Alle Status</option>
<option value="Verfügbar">Verfügbar</option>
<option value="in Betrieb">In Betrieb</option>
<option value="defekt">Defekt</option>
<option value="in Reparatur">In Reparatur</option>
<option value="ausgemustert">Ausgemustert</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Hersteller</label>
<select class="filter-select" id="filter-manufacturer">
<option value="">Alle Hersteller</option>
<option value="Dell">Dell</option>
<option value="HP">HP</option>
<option value="LENOVO">LENOVO</option>
<option value="Microsoft">Microsoft</option>
<option value="Apple">Apple</option>
<option value="Cisco">Cisco</option>
<option value="Juniper">Juniper</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Standort</label>
<select class="filter-select" id="filter-location">
<option value="">Alle Standorte</option>
<!-- Wird dynamisch gefüllt -->
</select>
</div>

<div class="filter-group">
<label class="filter-label">Sortieren nach</label>
<select class="filter-select" id="filter-sort">
<option value="assetId">Asset-Nummer (A-Z)</option>
<option value="assetId-desc">Asset-Nummer (Z-A)</option>
<option value="hostname">Hostname (A-Z)</option>
<option value="hostname-desc">Hostname (Z-A)</option>
<option value="timestamp">Neueste zuerst</option>
<option value="timestamp-oldest">Älteste zuerst</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Suchbegriff</label>
<input type="text" class="filter-input" id="filter-search" placeholder="Asset-Nummer, Hostname, Benutzer...">
</div>
</div>

<div class="filter-actions">
<button class="btn btn-outline" id="filter-reset">Zurücksetzen</button>
<button class="btn" id="filter-apply">Filter anwenden</button>
</div>
</div>

<div class="table-container fade-in">
<div class="table-header">
<h2 class="table-title">Alle Geräte</h2>
<div class="table-controls">
<button class="btn btn-outline" id="filter-toggle">
<i class="fas fa-filter"></i> Filter
</button>
<button class="btn" id="add-device-button">
<i class="fas fa-plus"></i> Gerät hinzufügen
</button>
</div>
</div>

<!-- Aktive Filter anzeigen -->
<div class="active-filters" id="active-filters">
<!-- Hier werden aktive Filter als Badges angezeigt -->
</div>

<table class="devices-table">
<thead>
<tr>
<th>Asset-Nummer</th>
<th>Hostname</th>
<th>Hersteller</th>
<th>Benutzer</th>
<th>Status</th>
<th>Standort</th>
<th>Letzte Aktivität</th>
</tr>
</thead>
<tbody>
<!-- Data will be populated by JavaScript -->
</tbody>
</table>

<!-- Pagination -->
<div class="pagination" id="devices-pagination"></div>
</div>
</section>

<!-- IP Addresses Section - MODERN & SIMPLIFIED -->
<section id="ip-addresses" class="dashboard-section">
    <div class="ip-section-header">
        <div class="ip-header-actions">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="ip-search" placeholder="IP, Hostname oder Gerät suchen...">
            </div>
            <button class="btn" id="add-ip-button">
                <i class="fas fa-plus"></i> IP zuweisen
            </button>
        </div>
    </div>

    <!-- IP-Adressen Statistik -->
    <div class="ip-stats">
        <div class="ip-stat-card">
            <div class="ip-stat-value" id="total-ips">0</div>
            <div class="ip-stat-label">Gesamte IP-Adressen</div>
        </div>
        <div class="ip-stat-card">
            <div class="ip-stat-value" id="free-ips">0</div>
            <div class="ip-stat-label">Freie IP-Adressen</div>
        </div>
    </div>

    <!-- IP-Pools werden hier als moderne Karten angezeigt -->
    <div id="ip-pools-container" class="ip-pools-grid">
        <!-- IP-Pools werden per JavaScript eingefügt -->
    </div>
</section>

<!-- Reports Section -->
<section id="reports" class="dashboard-section">

<div class="report-container">
<div class="report-header">
<h3 class="report-title">Gerätebestand</h3>
<div class="report-controls">
<select class="filter-select" id="report-type">
<option value="overview">Übersicht</option>
<option value="by-type">Nach Gerätetyp</option>
<option value="by-status">Nach Status</option>
<option value="by-location">Nach Standort</option>
<option value="by-manufacturer">Nach Hersteller</option>
<option value="by-user">Nach Benutzer</option>
<option value="aging">Gerätealterung</option>
<option value="warranty">Garantie-Übersicht</option>
<option value="inventory">Inventarliste</option>
</select>
<button class="btn" id="generate-report">
<i class="fas fa-chart-bar"></i> Report generieren
</button>
<button class="btn btn-outline" id="export-report">
<i class="fas fa-download"></i> Exportieren
</button>
</div>
</div>

<div class="report-options" id="report-options">
<!-- Report-Optionen werden hier dynamisch generiert -->
</div>

<div class="report-content" id="report-content">
<!-- Report-Inhalt wird hier dynamisch generiert -->
</div>
</div>
</section>

<!-- Console Section -->
<section id="console" class="dashboard-section">


<div class="console-container">
<div class="console-header">
<h3 class="console-title">Systemmeldungen</h3>
<div class="console-controls">
<button class="btn btn-outline" id="clear-console">
<i class="fas fa-trash"></i> Console leeren
</button>
<button class="btn" id="refresh-console">
<i class="fas fa-sync"></i> Aktualisieren
</button>
<button class="btn btn-outline" id="download-console">
<i class="fas fa-download"></i> Log herunterladen
</button>
</div>
</div>
<div class="console-content" id="console-content">
<div class="console-message">
<span class="console-timestamp" id="console-init-time"></span>
<span class="console-info">INFO:</span> Console initialisiert. Warte auf Daten vom Server...
</div>
</div>
<div class="log-stats" id="log-stats">
<span>Log-Größe: <strong id="log-size">0 KB</strong></span>
<span>Einträge: <strong id="log-entries">0</strong></span>
<span>Letzte Aktualisierung: <strong id="log-last-update">-</strong></span>
</div>
<div class="log-file-controls">
<button class="btn btn-outline" id="import-log">
<i class="fas fa-upload"></i> Log importieren
</button>
<button class="btn btn-outline" id="export-log">
<i class="fas fa-download"></i> Log exportieren
</button>
<input type="file" id="log-file-input" accept=".txt,.log,.json" style="display: none;">
</div>
<div class="console-status" id="console-status">
<span class="status-indicator status-connected"></span>
<span>Verbunden</span>
</div>
</div>
</section>

<!-- Settings Section -->
<section id="settings" class="dashboard-section">

<div class="settings-grid">
<!-- Theme Settings Card -->
<div class="settings-card fade-in">
<div class="settings-card-header">
<i class="fas fa-paint-brush"></i>
<h3>Darstellung</h3>
</div>
<div class="settings-card-body">
<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Dark Mode</span>
<span class="setting-description">Aktiviere den dunklen Modus</span>
</div>
<label class="switch">
<input type="checkbox" id="dark-mode-toggle">
<span class="slider"></span>
</label>
</div>

<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Diagrammtyp</span>
<span class="setting-description">Standard-Diagrammtyp festlegen</span>
</div>
<select class="select-input" id="chart-type-select">
<option value="doughnut">Kreisdiagramm</option>
<option value="bar">Balkendiagramm</option>
<option value="pie">Tortendiagramm</option>
<option value="polarArea">Polardiagramm</option>
</select>
</div>
</div>
</div>

<!-- Data Settings Card -->
<div class="settings-card fade-in">
<div class="settings-card-header">
<i class="fas fa-database"></i>
<h3>Datenverwaltung</h3>
</div>
<div class="settings-card-body">
<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Auto-Aktualisierung</span>
<span class="setting-description">Daten automatisch aktualisieren</span>
</div>
<label class="switch">
<input type="checkbox" id="auto-refresh-toggle">
<span class="slider"></span>
</label>
</div>

<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Aktualisierungsintervall</span>
<span class="setting-description">Intervall für</span>
<span class="setting-description">Auto-Aktualisierung</span>
</div>
<select class="select-input1" id="refresh-interval-select">
<option value="5000">5 Sekunden</option>
<option value="10000">10 Sekunden</option>
<option value="30000">30 Sekunden</option>
</select>
</div>

<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Benachrichtigungen</span>
<span class="setting-description">Zeige Benachrichtigungen</span>
</div>
<label class="switch">
<input type="checkbox" id="notifications-toggle">
<span class="slider"></span>
</label>
</div>
</div>
</div>

<!-- Table Settings Card -->
<div class="settings-card fade-in">
<div class="settings-card-header">
<i class="fas fa-table"></i>
<h3>Tabelleneinstellungen</h3>
</div>
<div class="settings-card-body">
<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Einträge pro Seite</span>
<span class="setting-description">Anzahl der Tabelleneinträge</span>
</div>
<select class="select-input" id="page-size-select">
<option value="10">10 Einträge</option>
<option value="25" selected>25 Einträge</option>
<option value="50">50 Einträge</option>
<option value="100">100 Einträge</option>
</select>
</div>

<div class="setting-item">
<div class="setting-info">
<span class="setting-label">Kompakter Modus</span>
<span class="setting-description">Reduziere den Abstand</span>
</div>
<label class="switch">
<input type="checkbox" id="compact-mode-toggle" checked>
<span class="slider"></span>
</label>
</div>
</div>
</div>

<!-- Actions Card -->
<div class="settings-card fade-in">
<div class="settings-card-header">
<i class="fas fa-cog"></i>
<h3>Aktionen</h3>
</div>
<div class="settings-card-body">
<button class="settings-action-btn" id="save-settings-btn">
<i class="fas fa-save"></i>
<span>Einstellungen speichern</span>
</button>
<button class="settings-action-btn" id="export-data-btn">
<i class="fas fa-download"></i>
<span>Daten exportieren</span>
</button>
<button class="settings-action-btn" id="reset-settings-btn">
<i class="fas fa-undo"></i>
<span>Einstellungen zurücksetzen</span>
</button>
<button class="settings-action-btn" id="clear-cache-btn">
<i class="fas fa-trash"></i>
<span>Cache leeren</span>
</button>
</div>
</div>

<!-- Info Card -->
<div class="settings-card fade-in">
<div class="settings-card-header">
<i class="fas fa-info-circle"></i>
<h3>Informationen</h3>
</div>
<div class="settings-card-body">
<div class="info-item">
<span class="info-label">Version:</span>
<span class="info-value">v3.1.0</span>
</div>

<div class="info-item">
<span class="info-label">Letzte Aktualisierung:</span>
<span class="info-value" id="last-update-time">-</span>
</div>

<div class="info-item">
<span class="info-label">Geräte in Datenbank:</span>
<span class="info-value" id="device-count">0</span>
</div>

<div class="info-item">
<span class="info-label">Speicherverbrauch:</span>
<span class="info-value" id="storage-usage">0 KB</span>
</div>
</div>
</div>
</div>
</section>
</main>

<!-- Device Detail Modal -->
<div class="modal-overlay" id="device-modal">
<div class="modal">
<div class="modal-header">
<h2 class="modal-title">Gerätedetails</h2>
<button class="modal-close" id="modal-close-btn">&times;</button>
</div>
<div class="modal-body">
<!-- Wird dynamisch befüllt -->
<div class="device-detail-grid"></div>
</div>
<div class="modal-footer">
<button class="btn" id="download-device-pdf">
<i class="fas fa-file-pdf"></i> Als PDF herunterladen
</button>
<button class="btn btn-outline" id="edit-device-btn">
<i class="fas fa-edit"></i> Bearbeiten
</button>
<button class="btn" style="background-color: var(--danger);" id="delete-device-btn">
<i class="fas fa-trash"></i> Gerät Löschen
</button>
</div>
</div>
</div>

<!-- Edit Device Modal -->
<div class="modal-overlay" id="edit-device-modal">
<div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
<div class="modal-header">
<h2 class="modal-title">Gerät bearbeiten</h2>
<button class="modal-close" id="edit-device-close-btn">&times;</button>
</div>
<div class="modal-body">
<form id="edit-device-form">
<!-- Allgemeine Informationen -->
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
<label class="filter-label">Asset-Nummer *</label>
<input type="text" class="filter-input" id="edit-device-assetId" required readonly>
</div>

<div class="filter-group">
<label class="filter-label">Seriennummer *</label>
<input type="text" class="filter-input" id="edit-device-serialNumber" required readonly>
</div>

<div class="filter-group">
<label class="filter-label">Hersteller *</label>
<input type="text" class="filter-input" id="edit-device-manufacturer" required readonly>
</div>

<div class="filter-group">
<label class="filter-label">Modell *</label>
<input type="text" class="filter-input" id="edit-device-model" required readonly>
</div>

<div class="filter-group">
<label class="filter-label">Status</label>
<select class="filter-select" id="edit-device-status">
<option value="Verfügbar">Verfügbar</option>
<option value="in Betrieb">In Betrieb</option>
<option value="defekt">Defekt</option>
<option value="in Reparatur">In Reparatur</option>
<option value="ausgemustert">Ausgemustert</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Standort</label>
<input type="text" class="filter-input" id="edit-device-location">
</div>

<div class="filter-group">
<label class="filter-label">Benutzer *</label>
<input type="text" class="filter-input" id="edit-device-user" required readonly>
</div>

<div class="filter-group" style="grid-column: span 2;">
<label class="filter-label">Bemerkungen</label>
<textarea class="filter-input" id="edit-device-notes" rows="3"></textarea>
</div>
</div>

<div class="filter-actions" style="margin-top: 20px;">
<button type="button" class="btn btn-outline" id="edit-device-cancel">Abbrechen</button>
<button type="submit" class="btn">Speichern</button>
</div>
</form>
</div>
</div>
</div>

<!-- Add Device Modal -->
<div class="modal-overlay" id="add-device-modal">
<div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
<div class="modal-header">
<h2 class="modal-title">Gerät hinzufügen</h2>
<button class="modal-close" id="add-device-close-btn">&times;</button>
</div>
<div class="modal-body">
<form id="add-device-form">
<!-- Gerätetyp-Auswahl -->
<div class="asset-type-selector">
<button type="button" class="asset-type-btn active" data-type="laptop">
<i class="fas fa-laptop"></i> Laptop
</button>
<button type="button" class="asset-type-btn" data-type="pc">
<i class="fas fa-desktop"></i> PC
</button>
<button type="button" class="asset-type-btn" data-type="server">
<i class="fas fa-server"></i> Server
</button>
<button type="button" class="asset-type-btn" data-type="printer">
<i class="fas fa-print"></i> Drucker
</button>
<button type="button" class="asset-type-btn" data-type="switch">
<i class="fas fa-network-wired"></i> Switch
</button>
<button type="button" class="asset-type-btn" data-type="firewall">
<i class="fas fa-shield-alt"></i> Firewall
</button>
<button type="button" class="asset-type-btn" data-type="ap">
<i class="fas fa-wifi"></i> Access Point
</button>
<button type="button" class="asset-type-btn" data-type="monitor">
<i class="fas fa-desktop"></i> Monitor
</button>
<button type="button" class="asset-type-btn" data-type="tablet">
<i class="fas fa-tablet-alt"></i> Tablet
</button>
<button type="button" class="asset-type-btn" data-type="smartphone">
<i class="fas fa-mobile-alt"></i> Smartphone
</button>
</div>

<!-- Allgemeine Informationen (für alle Gerätetypen) -->
<div class="asset-form-container active" id="general-form">
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
    <label class="filter-label">Asset-Nummer *</label>
    <input type="text" class="filter-input" id="new-device-assetId" required readonly>
    <button type="button" class="btn btn-outline" id="generate-asset-btn" style="margin-top: 5px;">
        <i class="fas fa-sync"></i> Neue Nummer generieren
    </button>
</div>

<div class="filter-group">
<label class="filter-label">Seriennummer *</label>
<input type="text" class="filter-input" id="new-device-serialNumber" required>
</div>

<div class="filter-group">
<label class="filter-label">Hersteller *</label>
<input type="text" class="filter-input" id="new-device-manufacturer" required>
</div>

<div class="filter-group">
<label class="filter-label">Modell *</label>
<input type="text" class="filter-input" id="new-device-model" required>
</div>

<div class="filter-group">
<label class="filter-label">Status</label>
<select class="filter-select" id="new-device-status">
<option value="Verfügbar">Verfügbar</option>
<option value="in Betrieb">In Betrieb</option>
<option value="defekt">Defekt</option>
<option value="in Reparatur">In Reparatur</option>
<option value="ausgemustert">Ausgemustert</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Standort</label>
<input type="text" class="filter-input" id="new-device-location">
</div>

<div class="filter-group">
    <label class="filter-label">Benutzer *</label>
    <select class="filter-input" id="new-device-user" required>
        <option value="">Benutzer auswählen oder eingeben...</option>
    </select>
</div>

<div class="filter-group" style="grid-column: span 2;">
<label class="filter-label">Bemerkungen</label>
<textarea class="filter-input" id="new-device-notes" rows="3"></textarea>
</div>
</div>
</div>

<!-- Endgeräte-spezifische Informationen (Laptop, PC, Tablet, Smartphone) -->
<div class="asset-form-container" id="end-device-form">
<div style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
<h3 style="margin-bottom: 15px;">Endgeräte-Informationen</h3>
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
<label class="filter-label">Hostname</label>
<input type="text" class="filter-input" id="new-device-hostname">
</div>

<div class="filter-group">
<label class="filter-label">Betriebssystem</label>
<input type="text" class="filter-input" id="new-device-os">
</div>

<div class="filter-group">
<label class="filter-label">CPU</label>
<input type="text" class="filter-input" id="new-device-cpu">
</div>

<div class="filter-group">
<label class="filter-label">RAM (GB)</label>
<input type="number" class="filter-input" id="new-device-ramGB" min="0" value="0">
</div>

<div class="filter-group">
<label class="filter-label">Anzahl Kerne</label>
<input type="number" class="filter-input" id="new-device-cores" min="0" value="0">
</div>

<div class="filter-group">
<label class="filter-label">Logische Prozessoren</label>
<input type="number" class="filter-input" id="new-device-logicalProc" min="0" value="0">
</div>
</div>

<!-- Storage-Informationen -->
<div style="margin-top: 15px;">
<h4 style="margin-bottom: 10px;">Speicher</h4>
<div id="storage-entries">
<div class="storage-entry" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
<input type="text" class="filter-input" placeholder="Typ (z.B. SSD, HDD)" name="storageType">
<input type="number" class="filter-input" placeholder="Größe (GB)" name="storageSize" min="0">
<input type="text" class="filter-input" placeholder="Schnittstelle (z.B. SATA, NVMe)" name="storageInterface">
<button type="button" class="btn btn-outline remove-storage" style="padding: 8px 12px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<button type="button" class="btn btn-outline" id="add-storage" style="margin-top: 10px;">
<i class="fas fa-plus"></i> Weitere Speichereinheit
</button>
</div>

<!-- Netzwerk-Informationen -->
<div style="margin-top: 15px;">
<h4 style="margin-bottom: 10px;">Netzwerk</h4>
<div id="network-entries">
<div class="network-entry" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
<input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
<input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
<input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
<button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<button type="button" class="btn btn-outline" id="add-network" style="margin-top: 10px;">
<i class="fas fa-plus"></i> Weitere Netzwerkschnittstelle
</button>
</div>
</div>
</div>

<!-- Server-spezifische Informationen -->
<div class="asset-form-container" id="server-form">
<div style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
<h3 style="margin-bottom: 15px;">Server-Informationen</h3>
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
<label class="filter-label">Hostname</label>
<input type="text" class="filter-input" id="new-device-hostname">
</div>

<div class="filter-group">
<label class="filter-label">Betriebssystem</label>
<input type="text" class="filter-input" id="new-device-os">
</div>

<div class="filter-group">
<label class="filter-label">CPU</label>
<input type="text" class="filter-input" id="new-device-cpu">
</div>

<div class="filter-group">
<label class="filter-label">RAM (GB)</label>
<input type="number" class="filter-input" id="new-device-ramGB" min="0" value="0">
</div>

<div class="filter-group">
<label class="filter-label">Rack</label>
<input type="text" class="filter-input" id="new-device-rack">
</div>

<div class="filter-group">
<label class="filter-label">Slot</label>
<input type="text" class="filter-input" id="new-device-slot">
</div>

<div class="filter-group">
<label class="filter-label">Betriebsklasse</label>
<select class="filter-select" id="new-device-operationClass">
<option value="Produktion">Produktion</option>
<option value="Test">Test</option>
<option value="Entwicklung">Entwicklung</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Verantwortlicher (IT)</label>
<input type="text" class="filter-input" id="new-device-itResponsible">
</div>
</div>

<!-- Netzwerk-Informationen -->
<div style="margin-top: 15px;">
<h4 style="margin-bottom: 10px;">Netzwerk</h4>
<div id="server-network-entries">
<div class="network-entry" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
<input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
<input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
<input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
<button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<button type="button" class="btn btn-outline" id="add-server-network" style="margin-top: 10px;">
<i class="fas fa-plus"></i> Weitere Netzwerkschnittstelle
</button>
</div>
</div>
</div>

<!-- Netzwerkgeräte-spezifische Informationen (Switch, Firewall, Access Point) -->
<div class="asset-form-container" id="network-device-form">
<div style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
<h3 style="margin-bottom: 15px;">Netzwerkgeräte-Informationen</h3>
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
<label class="filter-label">Hostname</label>
<input type="text" class="filter-input" id="new-device-hostname">
</div>

<div class="filter-group">
<label class="filter-label">Firmware-Version</label>
<input type="text" class="filter-input" id="new-device-firmware">
</div>

<div class="filter-group">
<label class="filter-label">Anzahl Ports</label>
<input type="number" class="filter-input" id="new-device-portCount" min="0" value="0">
</div>

<div class="filter-group">
<label class="filter-label">Standort im Netzwerk</label>
<input type="text" class="filter-input" id="new-device-networkLocation" placeholder="z.B. Rack A, Raum 123">
</div>

<div class="filter-group">
<label class="filter-label">Verantwortlicher (IT)</label>
<input type="text" class="filter-input" id="new-device-itResponsible">
</div>
</div>

<!-- Netzwerk-Informationen -->
<div style="margin-top: 15px;">
<h4 style="margin-bottom: 10px;">Management-Netzwerk</h4>
<div id="network-device-network-entries">
<div class="network-entry" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
<input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
<input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
<input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
<button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<button type="button" class="btn btn-outline" id="add-network-device-network" style="margin-top: 10px;">
<i class="fas fa-plus"></i> Weitere Netzwerkschnittstelle
</button>
</div>
</div>
</div>

<!-- Peripheriegeräte-spezifische Informationen (Monitor, Drucker) -->
<div class="asset-form-container" id="peripheral-device-form">
<div style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
<h3 style="margin-bottom: 15px;">Peripheriegeräte-Informationen</h3>
<div class="filter-grid" style="grid-template-columns: repeat(2, 1fr);">
<div class="filter-group">
<label class="filter-label">Anschluss</label>
<select class="filter-select" id="new-device-connection">
<option value="HDMI">HDMI</option>
<option value="DisplayPort">DisplayPort</option>
<option value="DVI">DVI</option>
<option value="VGA">VGA</option>
<option value="USB">USB</option>
<option value="Ethernet">Ethernet</option>
<option value="WiFi">WiFi</option>
</select>
</div>

<div class="filter-group">
<label class="filter-label">Auflösung / Funktion</label>
<input type="text" class="filter-input" id="new-device-resolution" placeholder="z.B. 1920x1080 oder Farblaser">
</div>
</div>
</div>
</div>

<div class="filter-actions" style="margin-top: 20px;">
<button type="button" class="btn btn-outline" id="add-device-cancel">Abbrechen</button>
<button type="submit" class="btn">Hinzufügen</button>
</div>
</form>
</div>
</div>
</div>

<!-- Add IP Modal -->
<div class="modal-overlay" id="add-ip-modal">
<div class="modal">
<div class="modal-header">
<h2 class="modal-title">IP-Adresse zuweisen</h2>
<button class="modal-close" id="add-ip-close-btn">&times;</button>
</div>
<div class="modal-body">
<form id="add-ip-form">
<div class="filter-group">
<label class="filter-label">IP-Adresse</label>
<input type="text" class="filter-input" id="new-ip-address" placeholder="z.B. 10.10.16.121" required>
</div>
<div class="filter-group">
<label class="filter-label">Subnetzmaske</label>
<input type="text" class="filter-input" id="new-ip-subnet" placeholder="z.B. 255.255.255.0" required>
</div>
<div class="filter-group">
<label class="filter-label">Gerät</label>
<select class="filter-select" id="new-ip-device">
<option value="">Gerät auswählen</option>
<!-- Geräte werden per JavaScript eingefügt -->
</select>
</div>
<div class="filter-actions">
<button type="button" class="btn btn-outline" id="add-ip-cancel">Abbrechen</button>
<button type="submit" class="btn">Zuweisen</button>
</div>
</form>
</div>
</div>
</div>

<div class="modal-overlay" id="password-modal">
    <div class="modal" style="max-width: 450px;">
        <div class="modal-header">
            <h2 class="modal-title">Gerät löschen</h2>
            <button class="modal-close" id="password-modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="password-prompt">
                <div class="password-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p>Um das Gerät <strong id="device-to-delete-name"></strong> zu löschen, müssen Sie das Administrator-Passwort eingeben.</p>
                <div class="password-input-container">
                    <input type="password" class="password-input" id="delete-password-input" placeholder="Passwort eingeben">
                    <div class="password-toggle" id="password-toggle-btn">
                        <i class="fas fa-eye"></i>
                    </div>
                </div>
                <div class="password-hint">
                    <small>Hinweis: Das Standardpasswort ist "ETKN2025!"</small>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="password-cancel-btn">Abbrechen</button>
            <button class="btn" id="password-confirm-btn" style="background-color: var(--danger);">
                <i class="fas fa-trash"></i> Gerät löschen
            </button>
        </div>
    </div>
</div>

</body>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Globale Variablen
    let autoRefreshInterval = null;
    let currentPage = 1;
    let pageSize = 25;
    let totalPages = 1;
    let eventSource;
    let consoleLogData = [];
    let currentDevice = null;
    let currentFilters = {
        deviceType: '',
        status: '',
        manufacturer: '',
        location: '',
        sort: 'assetNumber',
        search: ''
    };

    // Standard-Einstellungen
    const defaultSettings = {
        darkMode: false,
        chartType: 'doughnut',
        notifications: true,
        pageSize: 25,
        compactMode: true, // Kompakter Modus standardmäßig aktiv
        autoRefresh: false,
        refreshInterval: 10000,
    };

    // Globales Einstellungsobjekt
    window.appSettings = { ...defaultSettings };

    // Datenobjekte
    window.deviceData = [];

    // --- HAUPTINITIALISIERUNG ---

    // FIX: Die Funktion ist jetzt 'async', damit wir auf 'await' warten können
    async function initApp() {
        console.log("Initialisiere ETK-Asset Management App...");

        // 1. Lade Einstellungen aus localStorage
        loadSettings();

        // 2. Wende die geladenen Einstellungen auf die UI an
        applySettingsToUI(window.appSettings);

        // 3. Richte alle Event-Listener ein
        setupEventListeners();

        // 4. Lade die initialen Anwendungsdaten und WARTE, bis es fertig ist
        await initializeApp();

        // 5. Stelle den zuletzt aktiven Tab wieder her (oder zeige Dashboard)
        // Dieser Schritt wird erst ausgeführt, nachdem die Daten geladen sind.
        loadActiveSection();
    }

    // --- FUNKTIONEN ZUM LADEN UND SPEICHERN VON EINSTELLUNGEN ---

    function loadSettings() {
        try {
            const savedSettings = localStorage.getItem('etkAssetSettings');
            if (savedSettings) {
                const parsedSettings = JSON.parse(savedSettings);
                // Standardwerte mit gespeicherten Werten überschreiben
                Object.assign(window.appSettings, parsedSettings);
            }
        } catch (e) {
            console.error('Fehler beim Laden der Einstellungen:', e);
            // Bei Fehler werden die Standardwerte beibehalten
        }
    }

    function applySettingsToUI(settings) {
        // Dark Mode
        document.getElementById('dark-mode-toggle').checked = settings.darkMode;
        if (settings.darkMode) {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
        }

        // UI-Elemente mit Einstellungen befüllen
        document.getElementById('chart-type-select').value = settings.chartType;
        document.getElementById('notifications-toggle').checked = settings.notifications;
        document.getElementById('page-size-select').value = settings.pageSize;
        document.getElementById('compact-mode-toggle').checked = settings.compactMode;
        document.getElementById('auto-refresh-toggle').checked = settings.autoRefresh;
        document.getElementById('refresh-interval-select').value = settings.refreshInterval;

        // Kompatter Modus
        toggleCompactMode(settings.compactMode);

        // Auto-Refresh starten, falls aktiviert
        if (settings.autoRefresh) {
            startAutoRefresh(settings.refreshInterval);
        }
    }

    function saveSettings() {
        // Aktuelle Werte aus der UI lesen
        const settings = {
            darkMode: document.getElementById('dark-mode-toggle').checked,
            chartType: document.getElementById('chart-type-select').value,
            notifications: document.getElementById('notifications-toggle').checked,
            pageSize: parseInt(document.getElementById('page-size-select').value),
            compactMode: document.getElementById('compact-mode-toggle').checked,
            autoRefresh: document.getElementById('auto-refresh-toggle').checked,
            refreshInterval: parseInt(document.getElementById('refresh-interval-select').value),
        };

        try {
            // Im localStorage speichern
            localStorage.setItem('etkAssetSettings', JSON.stringify(settings));
            // Globales Objekt aktualisieren
            window.appSettings = settings;
            pageSize = settings.pageSize;

            // Auto-Refresh neu starten, falls nötig
            if (settings.autoRefresh) {
                startAutoRefresh(settings.refreshInterval);
            } else {
                stopAutoRefresh();
            }

            showNotification('Erfolg', 'Ihre Einstellungen wurden gespeichert.', 'success');
            return true;
        } catch (error) {
            console.error('Fehler beim Speichern der Einstellungen:', error);
            showNotification('Fehler', 'Einstellungen konnten nicht gespeichert werden.', 'error');
            return false;
        }
    }

    function saveActiveSection(sectionId) {
        localStorage.setItem('activeSection', sectionId);
    }

    function loadActiveSection() {
        const savedSection = localStorage.getItem('activeSection');
        // Prüfen, ob der gespeicherte Abschnitt gültig ist
        const menuItem = document.querySelector(`[data-section="${savedSection}"]`);
        if (savedSection && menuItem) {
            // Simuliere einen Klick, um den Tab zu wechseln
            menuItem.click();
        }
        // Wenn kein gültiger Abschnitt gespeichert ist, passiert nichts.
        // Das Dashboard ist per Standard im HTML aktiv.
    }

    // --- INITIALISIERUNG DER ANWENDUNG (Daten laden) ---

    async function initializeApp() {
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        const progressBar = document.getElementById('loading-progress-bar');

        try {
            loadingText.textContent = 'Lade Gerätedaten...';
            progressBar.style.width = '40%';

            await loadDeviceData();

            loadingText.textContent = 'Initialisiere Dashboard...';
            progressBar.style.width = '80%';

            if (window.deviceData) {
                updateStatistics(window.deviceData);
                createDashboardCharts(window.deviceData);
                updateDashboardTable(window.deviceData);
            }

            loadingText.textContent = 'Fertig!';
            progressBar.style.width = '100%';

            await new Promise(resolve => setTimeout(resolve, 500));

            loadingOverlay.classList.add('hidden');
            setTimeout(() => loadingOverlay.remove(), 800);

        } catch (error) {
            console.error('Fehler beim Initialisieren:', error);
            loadingText.textContent = 'Fehler beim Laden';
            progressBar.style.backgroundColor = '#F56565';
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
                setTimeout(() => loadingOverlay.remove(), 800);
            }, 3000);
        }
    }

    // --- EVENT-LISTENER SETUP ---

    function setupEventListeners() {
        // Menu-Navigation
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                if (!sectionId) return;

                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('.dashboard-section').forEach(section => section.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');

                document.querySelector('.page-title').textContent = this.querySelector('span').textContent;

                saveActiveSection(sectionId);

                if (window.innerWidth < 768) {
                    document.querySelector('.sidebar').classList.remove('active');
                }

                loadSectionData(sectionId);
            });
        });

        // Einstellungs-Listener mit sofortiger Anwendung
        document.getElementById('dark-mode-toggle').addEventListener('change', function() {
            // Dark Mode sofort anwenden
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('generate-asset-btn').addEventListener('click', () => {
            document.getElementById('new-device-assetId').value = generateAssetNumber();
        });

        document.getElementById('chart-type-select').addEventListener('change', function() {
            // Chart-Typ sofort anwenden
            window.appSettings.chartType = this.value;
            if (document.getElementById('dashboard').classList.contains('active') && window.deviceData) {
                createDashboardCharts(window.deviceData);
            }
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('notifications-toggle').addEventListener('change', function() {
            // Einstellung sofort anwenden
            window.appSettings.notifications = this.checked;
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('page-size-select').addEventListener('change', function() {
            // Seitengröße sofort anwenden
            window.appSettings.pageSize = parseInt(this.value);
            pageSize = window.appSettings.pageSize;
            if (document.getElementById('devices').classList.contains('active')) {
                applyFilters();
            }
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('compact-mode-toggle').addEventListener('change', function() {
            // Kompakten Modus sofort anwenden
            window.appSettings.compactMode = this.checked;
            toggleCompactMode(this.checked);
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('auto-refresh-toggle').addEventListener('change', function() {
            // Auto-Refresh sofort anwenden
            window.appSettings.autoRefresh = this.checked;
            if (this.checked) {
                startAutoRefresh(parseInt(document.getElementById('refresh-interval-select').value));
            } else {
                stopAutoRefresh();
            }
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('refresh-interval-select').addEventListener('change', function() {
            // Refresh-Intervall sofort anwenden
            window.appSettings.refreshInterval = parseInt(this.value);
            if (document.getElementById('auto-refresh-toggle').checked) {
                startAutoRefresh(parseInt(this.value));
            }
            // Einstellung speichern
            saveSettings();
        });

        document.getElementById('add-device-button').addEventListener('click', () => {
            // Generiere eine neue Asset-Nummer, wenn das Modal geöffnet wird
            document.getElementById('new-device-assetId').value = generateAssetNumber();
            
            // Fülle die Benutzer-Auswahl mit vorhandenen Benutzern
            const userSelect = document.getElementById('new-device-user');
            userSelect.innerHTML = '';
            
            // Sammle alle einzigartigen Benutzer aus den Gerätedaten
            const uniqueUsers = [...new Set(window.deviceData.map(device => device.user).filter(user => user))];
            
            // Füge die Benutzer zur Auswahl hinzu
            uniqueUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                userSelect.appendChild(option);
            });
            
            // Zeige das Modal
            document.getElementById('add-device-modal').classList.add('active');
        });

        // Andere Listener
        document.getElementById('refresh-data').addEventListener('click', handleRefreshData);
        document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
        document.getElementById('export-data-btn').addEventListener('click', exportData);
        document.getElementById('reset-settings-btn').addEventListener('click', resetSettings);
        document.getElementById('clear-cache-btn').addEventListener('click', clearCache);
        document.getElementById('download-ps-script').addEventListener('click', downloadPSScript);
        document.getElementById('clear-console').addEventListener('click', clearConsole);
        document.getElementById('refresh-console').addEventListener('click', refreshConsole);
        document.getElementById('download-console').addEventListener('click', downloadConsoleLog);
        document.getElementById('time-period-select').addEventListener('change', function() {
            if (window.deviceData) {
                createTimeChart(window.deviceData, parseInt(this.value));
            }
        });

        // Filter
        document.getElementById('filter-toggle').addEventListener('click', () => document.getElementById('filter-container').classList.add('active'));
        document.querySelector('#filter-container .modal-close').addEventListener('click', () => document.getElementById('filter-container').classList.remove('active'));
        document.getElementById('filter-apply').addEventListener('click', () => {
            currentFilters.status = document.getElementById('filter-status').value;
            currentFilters.manufacturer = document.getElementById('filter-manufacturer').value;
            currentFilters.location = document.getElementById('filter-location').value;
            currentFilters.sort = document.getElementById('filter-sort').value;
            currentFilters.search = document.getElementById('filter-search').value.toLowerCase();
            applyFilters();
            updateActiveFiltersDisplay();
            document.getElementById('filter-container').classList.remove('active');
        });
        document.getElementById('filter-reset').addEventListener('click', () => {
            currentFilters = {status: '', manufacturer: '', location: '', sort: 'assetNumber', search: '' };
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-manufacturer').value = '';
            document.getElementById('filter-location').value = '';
            document.getElementById('filter-sort').value = 'assetNumber';
            document.getElementById('filter-search').value = '';
            applyFilters();
            updateActiveFiltersDisplay();
        });

        // Mobile Menu Toggle
        document.querySelector('.menu-toggle').addEventListener('click', () => document.querySelector('.sidebar').classList.toggle('active'));

        // Modals
        document.getElementById('modal-close-btn').addEventListener('click', () => document.getElementById('device-modal').classList.remove('active'));
        document.getElementById('device-modal').addEventListener('click', (e) => { if (e.target.id === 'device-modal') document.getElementById('device-modal').classList.remove('active'); });
        document.getElementById('add-device-button').addEventListener('click', () => document.getElementById('add-device-modal').classList.add('active'));
        document.getElementById('add-device-close-btn').addEventListener('click', () => document.getElementById('add-device-modal').classList.remove('active'));
        document.getElementById('add-device-cancel').addEventListener('click', () => document.getElementById('add-device-modal').classList.remove('active'));
        document.getElementById('add-device-modal').addEventListener('click', (e) => { if (e.target.id === 'add-device-modal') document.getElementById('add-device-modal').classList.remove('active'); });
        document.getElementById('add-device-form').addEventListener('submit', handleAddDevice);

        // Edit Device Modal
        document.getElementById('edit-device-close-btn').addEventListener('click', () => document.getElementById('edit-device-modal').classList.remove('active'));
        document.getElementById('edit-device-cancel').addEventListener('click', () => document.getElementById('edit-device-modal').classList.remove('active'));
        document.getElementById('edit-device-modal').addEventListener('click', (e) => { if (e.target.id === 'edit-device-modal') document.getElementById('edit-device-modal').classList.remove('active'); });
        document.getElementById('edit-device-form').addEventListener('submit', handleEditDevice);

        // Add IP Modal
        document.getElementById('add-ip-button').addEventListener('click', () => {
            const deviceSelect = document.getElementById('new-ip-device');
            deviceSelect.innerHTML = '<option value="">Gerät auswählen</option>';
            if (window.deviceData) {
                window.deviceData.forEach(device => {
                    if (device.assetNumber) {
                        const option = document.createElement('option');
                        option.value = device.assetNumber;
                        option.textContent = `${device.assetNumber} - ${device.hostname || 'Unbekannt'}`;
                        deviceSelect.appendChild(option);
                    }
                });
            }
            document.getElementById('add-ip-modal').classList.add('active');
        });
        document.getElementById('add-ip-close-btn').addEventListener('click', () => document.getElementById('add-ip-modal').classList.remove('active'));
        document.getElementById('add-ip-cancel').addEventListener('click', () => document.getElementById('add-ip-modal').classList.remove('active'));
        document.getElementById('add-ip-modal').addEventListener('click', (e) => { if (e.target.id === 'add-ip-modal') document.getElementById('add-ip-modal').classList.remove('active'); });
        document.getElementById('add-ip-form').addEventListener('submit', handleAddIP);

        // Report Functions
        document.getElementById('generate-report').addEventListener('click', generateReport);
        document.getElementById('export-report').addEventListener('click', exportReport);
        document.getElementById('report-type').addEventListener('change', updateReportOptions);

        // Asset Type Selector
        document.querySelectorAll('.asset-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.asset-type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const type = this.getAttribute('data-type');
                document.querySelectorAll('.asset-form-container').forEach(container => {
                    container.classList.remove('active');
                });

                // Zeige das allgemeine Formular immer an
                document.getElementById('general-form').classList.add('active');

                // Zeige typspezifische Formulare basierend auf dem Gerätetyp
                if (['laptop', 'pc', 'tablet', 'smartphone'].includes(type)) {
                    document.getElementById('end-device-form').classList.add('active');
                } else if (type === 'server') {
                    document.getElementById('server-form').classList.add('active');
                } else if (['switch', 'firewall', 'ap'].includes(type)) {
                    document.getElementById('network-device-form').classList.add('active');
                } else if (['monitor', 'printer'].includes(type)) {
                    document.getElementById('peripheral-device-form').classList.add('active');
                }
            });
        });

        // Dynamic form fields
        document.getElementById('add-network').addEventListener('click', () => {
            const container = document.getElementById('network-entries');
            const entry = document.createElement('div');
            entry.className = 'network-entry';
            entry.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                <input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
                <input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
                <input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
                <button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
            </div>`;
            container.appendChild(entry);
            entry.querySelector('.remove-network').addEventListener('click', () => entry.remove());
        });

        document.getElementById('add-server-network').addEventListener('click', () => {
            const container = document.getElementById('server-network-entries');
            const entry = document.createElement('div');
            entry.className = 'network-entry';
            entry.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                <input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
                <input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
                <input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
                <button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
            </div>`;
            container.appendChild(entry);
            entry.querySelector('.remove-network').addEventListener('click', () => entry.remove());
        });

        document.getElementById('add-network-device-network').addEventListener('click', () => {
            const container = document.getElementById('network-device-network-entries');
            const entry = document.createElement('div');
            entry.className = 'network-entry';
            entry.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                <input type="text" class="filter-input" placeholder="IP-Adresse" name="ip">
                <input type="text" class="filter-input" placeholder="MAC-Adresse" name="mac">
                <input type="text" class="filter-input" placeholder="Subnetzmaske" name="subnet" value="255.255.255.0">
                <button type="button" class="btn btn-outline remove-network" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
            </div>`;
            container.appendChild(entry);
            entry.querySelector('.remove-network').addEventListener('click', () => entry.remove());
        });

        document.getElementById('add-storage').addEventListener('click', () => {
            const container = document.getElementById('storage-entries');
            const entry = document.createElement('div');
            entry.className = 'storage-entry';
            entry.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                <input type="text" class="filter-input" placeholder="Typ (z.B. SSD, HDD)" name="storageType">
                <input type="number" class="filter-input" placeholder="Größe (GB)" name="storageSize" min="0">
                <input type="text" class="filter-input" placeholder="Schnittstelle (z.B. SATA, NVMe)" name="storageInterface">
                <button type="button" class="btn btn-outline remove-storage" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
            </div>`;
            container.appendChild(entry);
            entry.querySelector('.remove-storage').addEventListener('click', () => entry.remove());
        });
    }

    function loadSectionData(sectionId) {
        switch(sectionId) {
            case 'devices':
                updateDevicesTable(window.deviceData);
                break;
            case 'ip-addresses':
                loadIPAddresses();
                break;
            case 'reports':
                updateReportSection();
                break;
            case 'console':
                setupConsoleConnection();
                break;
            case 'settings':
                updateInfoCard();
                break;
        }
    }

    // --- DATENLADEN-FUNKTIONEN ---

    async function loadDeviceData() {
        try {
            // Versuche, die Daten von der API zu laden
            const response = await fetch('api/devices');
            if (!response.ok) {
                throw new Error('Netzwerkantwort war nicht ok');
            }
            let deviceData = await response.json();

            // Stelle sicher, dass die Netzwerkdaten korrekt formatiert sind
            window.deviceData = deviceData.map(device => {
                if (!device.network) device.network = [];
                else if (!Array.isArray(device.network) && device.network.IPAddress) {
                    device.network = [device.network];
                }
                return device;
            });

            // Speichere die Daten im localStorage für Offline-Zugriff
            localStorage.setItem('deviceData', JSON.stringify(window.deviceData));

            return window.deviceData;
        } catch (error) {
            console.error('Fehler beim Laden der Gerätedaten:', error);

            // Versuche, die Daten aus dem localStorage zu laden
            try {
                const cachedData = localStorage.getItem('deviceData');
                if (cachedData) {
                    window.deviceData = JSON.parse(cachedData);
                    showNotification('Info', 'Verwende zwischengespeicherte Gerätedaten', 'info');
                    return window.deviceData;
                }
            } catch (cacheError) {
                console.error('Fehler beim Laden aus dem Cache:', cacheError);
            }

            // Fallback auf Beispieldaten, wenn nichts anderes funktioniert
            showNotification('Warnung', 'Verwende Beispieldaten, da keine Gerätedaten geladen werden konnten', 'warning');

            window.deviceData = [
                {
                    assetNumber: "T86W51KP",
                    hostname: "Beispiel-Laptop-01",
                    deviceType: "Laptop",
                    serialNumber: "SN123456789",
                    manufacturer: "Dell",
                    model: "Latitude 7420",
                    status: "in Betrieb",
                    location: "Büro 101",
                    user: "Max Mustermann",
                    purchaseDate: "2022-01-15",
                    warrantyExpiry: "2025-01-15",
                    cpu: "Intel Core i7-1185G7",
                    ramGB: 16,
                    cores: 4,
                    logicalProc: 8,
                    os: "Windows 11",
                    storage: [
                        { type: "SSD", size: 512, interface: "NVMe" }
                    ],
                    network: [
                        {
                            IPAddress: "192.168.1.100",
                            MACAddress: "00:11:22:33:44:55",
                            IPSubnet: "255.255.255.0"
                        },
                        {
                            IPAddress: "192.168.1.101",
                            MACAddress: "00:11:22:33:44:56",
                            IPSubnet: "255.255.255.0"
                        }
                    ],
                    notes: "Standard-Laptop für Entwickler",
                    timestamp: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    modifiedBy: "admin"
                },
                {
                    assetNumber: "T86W52KP",
                    hostname: "Beispiel-Server-01",
                    deviceType: "Server",
                    serialNumber: "SN987654321",
                    manufacturer: "HP",
                    model: "ProLiant DL380",
                    status: "in Betrieb",
                    location: "Serverraum A",
                    user: "IT-Admin",
                    purchaseDate: "2021-06-20",
                    warrantyExpiry: "2024-06-20",
                    cpu: "Intel Xeon Silver 4210",
                    ramGB: 64,
                    cores: 10,
                    logicalProc: 20,
                    os: "Windows Server 2019",
                    rack: "A",
                    slot: "5",
                    operationClass: "Produktion",
                    itResponsible: "IT-Admin",
                    network: [
                        {
                            IPAddress: "10.10.16.10",
                            MACAddress: "AA:BB:CC:DD:EE:FF",
                            IPSubnet: "255.255.255.0"
                        }
                    ],
                    notes: "Datenbankserver",
                    timestamp: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    modifiedBy: "admin"
                },
                {
                    assetNumber: "T86W53KP",
                    hostname: "Beispiel-PC-02",
                    deviceType: "PC",
                    serialNumber: "SN555666777",
                    manufacturer: "Lenovo",
                    model: "ThinkCentre M70q",
                    status: "in Betrieb",
                    location: "Büro 205",
                    user: "Erika Musterfrau",
                    purchaseDate: "2023-03-10",
                    warrantyExpiry: "2026-03-10",
                    cpu: "AMD Ryzen 5 5600G",
                    ramGB: 32,
                    cores: 6,
                    logicalProc: 12,
                    os: "Windows 11",
                    network: [
                        {
                            IPAddress: "192.168.1.102",
                            MACAddress: "10:20:30:40:50:60",
                            IPSubnet: "255.255.255.0"
                        }
                    ],
                    notes: "Arbeitsplatz im Vertrieb",
                    timestamp: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    modifiedBy: "admin"
                }
            ];

            return window.deviceData;
        }
    }

    // --- KERNFUNKTIONEN (Daten, UI, etc.) ---

    function updateStatistics(deviceData) {
        // 1. Gesamte Anzahl der Geräte
        const totalDevices = deviceData.length;
        
        // Zähler für die neuen Kategorien initialisieren
        let newDevicesThisWeek = 0;

        // --- IP-Adressen-Logik ---
        // Verwende dieselbe Methode wie in updateIPAddresses
        const ipPools = detectIPPools(deviceData);
        let totalIPsInPools = 0;
        let usedIPsCount = 0;
        
        Object.values(ipPools).forEach(pool => {
            if (typeof pool === 'object' && pool.range) {
                totalIPsInPools += pool.range;
                usedIPsCount += pool.usedIPs || 0;
            }
        });

        // Verwende die Gesamtzahl der einzigartigen IP-Adressen, falls verfügbar
        if (ipPools.totalUniqueIPs !== undefined) {
            usedIPsCount = ipPools.totalUniqueIPs;
        }

        const availableIPsCount = totalIPsInPools - usedIPsCount;

        // --- Logik für neue Geräte ---
        const oneWeekAgo = new Date(new Date().getTime() - (7 * 24 * 60 * 60 * 1000));
        deviceData.forEach(device => {
            if (device.timestamp) {
                const deviceDate = new Date(device.timestamp);
                if (deviceDate >= oneWeekAgo) {
                    newDevicesThisWeek++;
                }
            }
        });

        // --- UI-Elemente aktualisieren ---
        document.getElementById('total-devices').textContent = totalDevices;
        document.getElementById('available-ips').textContent = availableIPsCount;
        document.getElementById('used-ips').textContent = usedIPsCount;
        document.getElementById('new-devices-week').textContent = newDevicesThisWeek;
    }

    function detectIPPools(deviceData) {
        const pools = {};
        
        // Erstelle eine globale Menge für alle einzigartigen IP-Adressen
        const allUniqueIPs = new Set();
        
        deviceData.forEach(device => {
            if (device.network && Array.isArray(device.network)) {
                device.network.forEach(net => {
                    if (net.IPAddress) {
                        allUniqueIPs.add(net.IPAddress);
                        
                        const match = net.IPAddress.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);
                        if (match) {
                            const network = `${match[1]}.${match[2]}.${match[3]}`;
                            if (!pools[network]) {
                                pools[network] = {
                                    network: network + '.0',
                                    subnet: net.IPSubnet || '255.255.255.0',
                                    range: 254, // Annahme: /24 Netzwerk
                                    usedIPs: 0,
                                    devices: []
                                };
                            }
                            
                            // IPs des Geräts als Set für schnellen Lookup speichern
                            if (!device.ips) device.ips = new Set();
                            device.ips.add(net.IPAddress);

                            // Gerät nur einmal pro Pool hinzufügen
                            if (!pools[network].devices.some(d => d.assetNumber === device.assetNumber)) {
                                pools[network].devices.push(device);
                            }
                        }
                    }
                });
            }
        });

        // Zähle die einzigartigen verwendeten IPs pro Pool
        Object.values(pools).forEach(pool => {
            const uniqueIPs = new Set();
            pool.devices.forEach(device => {
                if (device.ips) {
                    device.ips.forEach(ip => {
                        if (ip.startsWith(pool.network.substring(0, pool.network.lastIndexOf('.')))) {
                            uniqueIPs.add(ip);
                        }
                    });
                }
            });
            pool.usedIPs = uniqueIPs.size;
        });

        // Speichere die Gesamtzahl der einzigartigen IP-Adressen global
        pools.totalUniqueIPs = allUniqueIPs.size;

        return pools;
    }

    function createDashboardCharts(deviceData) {
        createManufacturerChart(deviceData);
        createDeviceStatusChart(deviceData);
        createOSChart(deviceData);
        createTimeChart(deviceData, 24);
    }

    function createManufacturerChart(deviceData) {
        const manufacturerCounts = {};
        deviceData.forEach(device => {
            if (device.manufacturer) {
                manufacturerCounts[device.manufacturer] = (manufacturerCounts[device.manufacturer] || 0) + 1;
            }
        });

        const ctx = document.getElementById('manufacturer-chart');
        if (ctx) {
            if (window.manufacturerChartInstance) window.manufacturerChartInstance.destroy();
            window.manufacturerChartInstance = new Chart(ctx.getContext('2d'), {
                type: window.appSettings.chartType,
                data: {
                    labels: Object.keys(manufacturerCounts),
                    datasets: [{
                        data: Object.values(manufacturerCounts),
                        backgroundColor: ['#FF7700', '#FF9838', '#FFB870', '#FFD8B8', '#4299E1', '#48BB78'],
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    }

    function createDeviceStatusChart(deviceData) {
        const statusCounts = {};
        deviceData.forEach(device => {
            if (device.status) {
                statusCounts[device.status] = (statusCounts[device.status] || 0) + 1;
            }
        });

        const ctx = document.getElementById('device-status-chart');
        if (ctx) {
            if (window.deviceStatusChartInstance) window.deviceStatusChartInstance.destroy();
            window.deviceStatusChartInstance = new Chart(ctx.getContext('2d'), {
                type: window.appSettings.chartType,
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: [
                            '#48BB78', // Verfügbar - Grün
                            '#F56565', // In Betrieb - Rot
                            '#ECC94B', // Defekt - Dunkelrot
                            '#8B0000', // In Reparatur - Orange
                            '#9F7AEA'  // Ausgemustert - Lila
                        ],
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    }

    function createOSChart(deviceData) {
        const osCounts = {};
        deviceData.forEach(device => {
            if (device.os) {
                osCounts[device.os] = (osCounts[device.os] || 0) + 1;
            }
        });

        const ctx = document.getElementById('os-chart');
        if (ctx) {
            if (window.osChartInstance) window.osChartInstance.destroy();
            window.osChartInstance = new Chart(ctx.getContext('2d'), {
                type: window.appSettings.chartType,
                data: {
                    labels: Object.keys(osCounts),
                    datasets: [{
                        data: Object.values(osCounts),
                        backgroundColor: ['#FF7700', '#4299E1', '#48BB78', '#ECC94B', '#9F7AEA'],
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    }

    function createTimeChart(deviceData, hours = 24) {
        const now = new Date();
        const timeAgo = new Date(now - hours * 60 * 60 * 1000);
        const filteredDevices = deviceData.filter(device => new Date(device.timestamp) >= timeAgo);

        let labels = [], data = [];
        let totalAdded = 0;

        if (hours <= 24) {
            // Stündliche Ansicht für 24 Stunden
            for (let i = 23; i >= 0; i--) {
                const hourStart = new Date(now - i * 60 * 60 * 1000);
                const hourEnd = new Date(now - (i - 1) * 60 * 60 * 1000);
                const hourDevices = filteredDevices.filter(device => {
                    const deviceDate = new Date(device.timestamp);
                    return deviceDate >= hourStart && deviceDate < hourEnd;
                });
                
                const hourLabel = i === 0 ? 'Jetzt' : `Vor ${i}h`;
                labels.push(hourLabel);
                data.push(hourDevices.length);
                totalAdded += hourDevices.length;
            }
        } else if (hours <= 168) {
            // Tägliche Ansicht für eine Woche
            const days = Math.ceil(hours / 24);
            for (let i = days - 1; i >= 0; i--) {
                const dayStart = new Date(now - i * 24 * 60 * 60 * 1000);
                dayStart.setHours(0, 0, 0, 0);
                const dayEnd = new Date(dayStart);
                dayEnd.setHours(23, 59, 59, 999);
                
                const dayDevices = filteredDevices.filter(device => {
                    const deviceDate = new Date(device.timestamp);
                    return deviceDate >= dayStart && deviceDate <= dayEnd;
                });
                
                const dayLabel = i === 0 ? 'Heute' : i === 1 ? 'Gestern' : dayStart.toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric' });
                labels.push(dayLabel);
                data.push(dayDevices.length);
                totalAdded += dayDevices.length;
            }
        } else {
            // Wöchentliche Ansicht für einen Monat
            const weeks = Math.ceil(hours / (7 * 24));
            for (let i = weeks - 1; i >= 0; i--) {
                const weekStart = new Date(now - i * 7 * 24 * 60 * 60 * 1000);
                weekStart.setHours(0, 0, 0, 0);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);
                
                const weekDevices = filteredDevices.filter(device => {
                    const deviceDate = new Date(device.timestamp);
                    return deviceDate >= weekStart && deviceDate <= weekEnd;
                });
                
                const weekLabel = i === 0 ? 'Diese Woche' : `KW ${getWeekNumber(weekStart)}`;
                labels.push(weekLabel);
                data.push(weekDevices.length);
                totalAdded += weekDevices.length;
            }
        }

        // Sicherer Zugriff auf die Zusammenfassungs-Elemente
        const totalAddedElement = document.getElementById('total-added');
        const avgPerDayElement = document.getElementById('avg-per-day');

        if (totalAddedElement) {
            totalAddedElement.textContent = totalAdded;
        }
        
        const avgPerDay = hours <= 24 ? totalAdded : Math.round(totalAdded / (hours / 24));
        if (avgPerDayElement) {
            avgPerDayElement.textContent = avgPerDay;
        }

        const ctx = document.getElementById('time-chart');
        if (ctx) {
            if (window.timeChartInstance) window.timeChartInstance.destroy();
            window.timeChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Neue Geräte',
                        data: data,
                        backgroundColor: data.map(value => value > 0 ? '#FF7700' : '#E2E8F0'),
                        borderColor: data.map(value => value > 0 ? '#FF7700' : '#E2E8F0'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} Gerät${context.parsed.y !== 1 ? 'e' : ''} hinzugefügt`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: 'Anzahl neuer Geräte'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: hours <= 24 ? 'Stunden' : hours <= 168 ? 'Tage' : 'Wochen'
                            }
                        }
                    }
                }
            });
        }
    }

    // Hilfsfunktion zur Ermittlung der Kalenderwoche
    function getWeekNumber(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
    }

    function updateDashboardTable(deviceData) {
        const tbody = document.querySelector('#dashboard .devices-table tbody');
        if (!tbody) return;

        if (deviceData.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="error-message"><i class="fas fa-exclamation-triangle"></i> Keine Gerätedaten gefunden</td></tr>`;
            return;
        }

        const recentDevices = [...deviceData].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 4);
        tbody.innerHTML = '';

        recentDevices.forEach(device => {
            const row = document.createElement('tr');
            const lastSeen = new Date(device.timestamp);
            const now = new Date();
            const diffMins = Math.floor((now - lastSeen) / 60000);
            let timeAgo = 'Gerade eben';
            if (diffMins >= 1 && diffMins < 60) timeAgo = `Vor ${diffMins} Minute${diffMins > 1 ? 'n' : ''}`;
            else if (diffMins >= 60) {
                const diffHours = Math.floor(diffMins / 60);
                timeAgo = `Vor ${diffHours} Stunde${diffHours > 1 ? 'n' : ''}`;
            }

            // Status-Badge
            let statusBadge = '';
            switch (device.status) {
                case 'Verfügbar':
                    statusBadge = '<span class="status-badge status-available">Verfügbar</span>';
                    break;
                case 'in Betrieb':
                    statusBadge = '<span class="status-badge status-in-use">In Betrieb</span>';
                    break;
                case 'defekt':
                    statusBadge = '<span class="status-badge status-defect">Defekt</span>';
                    break;
                case 'in Reparatur':
                    statusBadge = '<span class="status-badge status-repair">In Reparatur</span>';
                    break;
                case 'ausgemustert':
                    statusBadge = '<span class="status-badge status-retired">Ausgemustert</span>';
                    break;
                default:
                    statusBadge = `<span class="status-badge">${device.status || 'Unbekannt'}</span>`;
            }

            row.innerHTML = `
                <td>${device.assetNumber || '-'}</td>
                <td>${device.hostname || '-'}</td>
                <td>${device.manufacturer || '-'}</td>
                <td>${device.user || '-'}</td>
                <td>${statusBadge}</td>
                <td>${timeAgo}</td>
            `;
            row.addEventListener('click', () => showDeviceDetails(device));
            tbody.appendChild(row);
        });
    }

    function updateDevicesTable(deviceData) {
        const tbody = document.querySelector('#devices .devices-table tbody');
        if (!tbody) return;

        if (!deviceData || deviceData.length === 0) {
            tbody.innerHTML = `<tr><td colspan="7" class="error-message"><i class="fas fa-exclamation-triangle"></i> Keine Gerätedaten gefunden</td></tr>`;
            document.getElementById('devices-pagination').innerHTML = '';
            return;
        }

        totalPages = Math.ceil(deviceData.length / pageSize);
        currentPage = Math.min(currentPage, totalPages);

        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, deviceData.length);
        const pagedData = deviceData.slice(startIndex, endIndex);

        tbody.innerHTML = '';
        pagedData.forEach(device => {
            const row = document.createElement('tr');

            // Status-Badge
            let statusBadge = '';
            switch (device.status) {
                case 'Verfügbar':
                    statusBadge = '<span class="status-badge status-available">Verfügbar</span>';
                    break;
                case 'in Betrieb':
                    statusBadge = '<span class="status-badge status-in-use">In Betrieb</span>';
                    break;
                case 'defekt':
                    statusBadge = '<span class="status-badge status-defect">Defekt</span>';
                    break;
                case 'in Reparatur':
                    statusBadge = '<span class="status-badge status-repair">In Reparatur</span>';
                    break;
                case 'ausgemustert':
                    statusBadge = '<span class="status-badge status-retired">Ausgemustert</span>';
                    break;
                default:
                    statusBadge = `<span class="status-badge">${device.status || 'Unbekannt'}</span>`;
            }

            row.innerHTML = `
                <td>${device.assetNumber || '-'}</td>
                <td>${device.hostname || '-'}</td>
                <td>${device.manufacturer || '-'}</td>
                <td>${device.user || '-'}</td>
                <td>${statusBadge}</td>
                <td>${device.location || '-'}</td>
                <td>${device.timestamp ? new Date(device.timestamp).toLocaleString('de-DE') : '-'}</td>
            `;
            row.addEventListener('click', () => showDeviceDetails(device));
            tbody.appendChild(row);
        });

        updatePagination('devices-pagination', deviceData.length);
    }

    function updatePagination(paginationId, totalItems) {
        const paginationContainer = document.getElementById(paginationId);
        if (!paginationContainer || totalItems <= pageSize) return;

        paginationContainer.innerHTML = '';

        const prevButton = document.createElement('button');
        prevButton.innerHTML = '&laquo;';
        prevButton.disabled = currentPage === 1;
        prevButton.addEventListener('click', () => { if (currentPage > 1) { currentPage--; applyFilters(); } });
        paginationContainer.appendChild(prevButton);

        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, startPage + 4);

        for (let i = startPage; i <= endPage; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            pageButton.classList.toggle('active', i === currentPage);
            pageButton.addEventListener('click', () => { currentPage = i; applyFilters(); });
            paginationContainer.appendChild(pageButton);
        }

        const nextButton = document.createElement('button');
        nextButton.innerHTML = '&raquo;';
        nextButton.disabled = currentPage === totalPages;
        nextButton.addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; applyFilters(); } });
        paginationContainer.appendChild(nextButton);
    }

    function showDeviceDetails(device) {
        currentDevice = device;
        const modalBody = document.querySelector('#device-modal .modal-body');
        modalBody.innerHTML = ''; // Clear previous content

        // Erstelle einen modernen Container für alle Details
        const detailsContainer = document.createElement('div');
        detailsContainer.className = 'device-details-container';

        // Header mit Gerätename und Status
        const deviceHeader = document.createElement('div');
        deviceHeader.className = 'device-header';

        const deviceTitle = document.createElement('div');
        deviceTitle.className = 'device-title';
        deviceTitle.innerHTML = `
            <h2>${device.hostname || 'Unbekanntes Gerät'}</h2>
            <div class="device-subtitle">${device.assetNumber || 'Keine Asset-Nummer'} • ${device.manufacturer} ${device.model || ''}</div>
        `;

        // Status-Badge
        let statusBadge = '';
        let statusClass = '';
        switch (device.status) {
            case 'Verfügbar':
                statusBadge = 'Verfügbar';
                statusClass = 'status-available';
                break;
            case 'in Betrieb':
                statusBadge = 'In Betrieb';
                statusClass = 'status-active';
                break;
            case 'defekt':
                statusBadge = 'Defekt';
                statusClass = 'status-error';
                break;
            case 'in Reparatur':
                statusBadge = 'In Reparatur';
                statusClass = 'status-warning';
                break;
            case 'ausgemustert':
                statusBadge = 'Ausgemustert';
                statusClass = 'status-retired';
                break;
            default:
                statusBadge = device.status || 'Unbekannt';
                statusClass = 'status-unknown';
        }

        const deviceStatus = document.createElement('div');
        deviceStatus.className = `device-status ${statusClass}`;
        deviceStatus.textContent = statusBadge;

        deviceHeader.appendChild(deviceTitle);
        deviceHeader.appendChild(deviceStatus);
        detailsContainer.appendChild(deviceHeader);

        // Erstelle Tabs für verschiedene Kategorien
        const tabsContainer = document.createElement('div');
        tabsContainer.className = 'device-tabs';

        const tabsContent = document.createElement('div');
        tabsContent.className = 'device-tabs-content';

        // Tab-Daten
        const tabs = [
            {
                id: 'general',
                title: 'Allgemein',
                icon: 'fa-desktop',
                content: createGeneralTab(device)
            },
            {
                id: 'hardware',
                title: 'Hardware',
                icon: 'fa-microchip',
                content: createHardwareTab(device)
            },
            {
                id: 'storage',
                title: 'Speicher',
                icon: 'fa-hdd',
                content: createStorageTab(device)
            },
            {
                id: 'network',
                title: 'Netzwerk',
                icon: 'fa-network-wired',
                content: createNetworkTab(device)
            }
        ];

        // Erstelle Tabs
        tabs.forEach((tab, index) => {
            const tabButton = document.createElement('button');
            tabButton.className = `tab-button ${index === 0 ? 'active' : ''}`;
            tabButton.setAttribute('data-tab', tab.id);
            tabButton.innerHTML = `<i class="fas ${tab.icon}"></i> ${tab.title}`;

            tabButton.addEventListener('click', () => {
                // Entferne active-Klasse von allen Tabs und Buttons
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));

                // Füge active-Klasse zum geklickten Tab und Button hinzu
                tabButton.classList.add('active');
                document.getElementById(`tab-${tab.id}`).classList.add('active');
            });

            tabsContainer.appendChild(tabButton);

            // Erstelle Tab-Pane
            const tabPane = document.createElement('div');
            tabPane.className = `tab-pane ${index === 0 ? 'active' : ''}`;
            tabPane.id = `tab-${tab.id}`;
            tabPane.appendChild(tab.content);

            tabsContent.appendChild(tabPane);
        });

        detailsContainer.appendChild(tabsContainer);
        detailsContainer.appendChild(tabsContent);

        // Füge den Container zum Modal hinzu
        modalBody.appendChild(detailsContainer);

        // Event-Listener für die Footer-Buttons hinzufügen
        document.getElementById('download-device-pdf').onclick = downloadDevicePDF;
        document.getElementById('edit-device-btn').onclick = () => {
            document.getElementById('device-modal').classList.remove('active');
            showEditDeviceModal(currentDevice);
        };

        document.getElementById('device-modal').classList.add('active');
    }

    // Funktion zum Erstellen des "Allgemein"-Tabs
    function createGeneralTab(device) {
        const tabContent = document.createElement('div');
        tabContent.className = 'tab-content';

        // Erstelle eine Tabelle für die allgemeinen Informationen
        const table = document.createElement('table');
        table.className = 'detail-table';

        const rows = [
            ['Computername', device.hostname || '-'],
            ['Angemeldeter Benutzer', device.user || '-'],
            ['Betriebssystem', device.os || '-'],
            ['OS-Version', device.osVersion || '-'],
            ['OS-Architektur', device.osArch || '-'],
            ['Gerätehersteller', device.manufacturer || '-'],
            ['Modell', device.model || '-'],
            ['Seriennummer', device.serialNumber || '-'],
            ['BIOS-Version', device.biosVersion || '-'],
            ['Asset-Nummer', device.assetNumber || '-'],
            ['Standort', device.location || '-'],
            ['Status', getStatusBadge(device.status)],
            ['Notizen', device.notes || '-'],
            ['Letzte Aktualisierung', device.timestamp ? new Date(device.timestamp).toLocaleString('de-DE') : '-']
        ];

        rows.forEach(([label, value]) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="detail-label">${label}</td>
                <td class="detail-value">${value}</td>
            `;
            table.appendChild(row);
        });

        tabContent.appendChild(table);
        return tabContent;
    }

    // Funktion zum Erstellen des "Hardware"-Tabs
    function createHardwareTab(device) {
        const tabContent = document.createElement('div');
        tabContent.className = 'tab-content';

        // CPU-Informationen
        const cpuSection = document.createElement('div');
        cpuSection.className = 'detail-section';
        cpuSection.innerHTML = `
            <h3 class="detail-section-title"><i class="fas fa-microchip"></i> CPU-Informationen</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Prozessor</div>
                    <div class="detail-value">${device.cpu || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Anzahl Kerne</div>
                    <div class="detail-value">${device.cores || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Logische Prozessoren</div>
                    <div class="detail-value">${device.logicalProc || '-'}</div>
                </div>
            </div>
        `;

        // RAM-Informationen
        const ramSection = document.createElement('div');
        ramSection.className = 'detail-section';
        ramSection.innerHTML = `
            <h3 class="detail-section-title"><i class="fas fa-memory"></i> Arbeitsspeicher</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Gesamtspeicher</div>
                    <div class="detail-value">${device.ramGB ? `${device.ramGB} GB` : '-'}</div>
                </div>
            </div>
        `;

        // GPU-Informationen
        let gpuSection = document.createElement('div');
        gpuSection.className = 'detail-section';

        if (device.gpu && Array.isArray(device.gpu) && device.gpu.length > 0) {
            let gpuHtml = '<h3 class="detail-section-title"><i class="fas fa-tv"></i> Grafikkarten</h3><div class="gpu-grid">';

            device.gpu.forEach((gpu, index) => {
                gpuHtml += `
                    <div class="gpu-card">
                        <div class="gpu-header">
                            <div class="gpu-name">${gpu.Name || 'Unbekannte GPU'}</div>
                            <div class="gpu-type">GPU ${index + 1}</div>
                        </div>
                        <div class="gpu-details">
                            <div class="gpu-detail">
                                <div class="detail-label">Speicher</div>
                                <div class="detail-value">${gpu.AdapterRAMGB ? `${gpu.AdapterRAMGB} GB` : 'N/A'}</div>
                            </div>
                            <div class="gpu-detail">
                                <div class="detail-label">Treiber</div>
                                <div class="detail-value">${gpu.DriverVersion || 'N/A'}</div>
                            </div>
                            <div class="gpu-detail">
                                <div class="detail-label">Treiberdatum</div>
                                <div class="detail-value">${gpu.DriverDate || 'N/A'}</div>
                            </div>
                            <div class="gpu-detail">
                                <div class="detail-label">Video-Prozessor</div>
                                <div class="detail-value">${gpu.VideoProcessor || 'N/A'}</div>
                            </div>
                            <div class="gpu-detail">
                                <div class="detail-label">Auflösung</div>
                                <div class="detail-value">${gpu.VideoModeDescription || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            gpuHtml += '</div>';
            gpuSection.innerHTML = gpuHtml;
        } else {
            gpuSection.innerHTML = `
                <h3 class="detail-section-title"><i class="fas fa-tv"></i> Grafikkarten</h3>
                <div class="no-data">Keine Grafikarten-Informationen verfügbar</div>
            `;
        }

        tabContent.appendChild(cpuSection);
        tabContent.appendChild(ramSection);
        tabContent.appendChild(gpuSection);

        return tabContent;
    }

    function createStorageTab(device) {
        const tabContent = document.createElement('div');
        tabContent.className = 'tab-content';

        // Lokale Festplatten
        let localDrivesSection = document.createElement('div');
        localDrivesSection.className = 'detail-section';

        if (device.drives && device.drives.localDrives && device.drives.localDrives.length > 0) {
            let drivesHtml = '<h3 class="detail-section-title"><i class="fas fa-hdd"></i> Lokale Festplatten</h3><div class="drives-grid">';

            device.drives.localDrives.forEach((drive, index) => {
                const usedPercentage = drive.UsedPercentage || 0;
                const usedColor = usedPercentage > 80 ? 'var(--danger)' : usedPercentage > 60 ? 'var(--warning)' : 'var(--success)';

                drivesHtml += `
                    <div class="drive-card">
                        <div class="drive-header">
                            <div class="drive-name">${drive.DeviceID || 'Unbekanntes Laufwerk'}</div>
                            <div class="drive-type">${drive.VolumeName || 'Kein Name'}</div>
                        </div>
                        <div class="drive-usage">
                            <div class="usage-bar">
                                <div class="usage-fill" style="width: ${usedPercentage}%; background-color: ${usedColor};"></div>
                            </div>
                            <div class="usage-text">${drive.UsedGB || 0} GB / ${drive.SizeGB || 0} GB (${usedPercentage}%)</div>
                        </div>
                        <div class="drive-details">
                            <div class="drive-detail">
                                <div class="detail-label">Freier Speicher</div>
                                <div class="detail-value">${drive.FreeGB || 0} GB</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Dateisystem</div>
                                <div class="detail-value">${drive.FileSystem || 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Seriennummer</div>
                                <div class="detail-value">${drive.VolumeSerialNumber || 'N/A'}</div>
                            </div>
                            ${drive.PartitionType ? `
                            <div class="drive-detail">
                                <div class="detail-label">Partitionstyp</div>
                                <div class="detail-value">${drive.PartitionType || 'N/A'}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            drivesHtml += '</div>';
            localDrivesSection.innerHTML = drivesHtml;
        } else {
            localDrivesSection.innerHTML = `
                <h3 class="detail-section-title"><i class="fas fa-hdd"></i> Lokale Festplatten</h3>
                <div class="no-data">Keine lokalen Festplatten-Informationen verfügbar</div>
            `;
        }

        // Netzlaufwerke
        let networkDrivesSection = document.createElement('div');
        networkDrivesSection.className = 'detail-section';

        if (device.drives && device.drives.networkDrives && device.drives.networkDrives.length > 0) {
            let drivesHtml = '<h3 class="detail-section-title"><i class="fas fa-network-wired"></i> Netzlaufwerke</h3><div class="drives-grid">';

            device.drives.networkDrives.forEach((drive, index) => {
                const usedPercentage = drive.UsedPercentage || 0;
                const usedColor = usedPercentage > 80 ? 'var(--danger)' : usedPercentage > 60 ? 'var(--warning)' : 'var(--success)';

                drivesHtml += `
                    <div class="drive-card">
                        <div class="drive-header">
                            <div class="drive-name">${drive.DeviceID || 'Unbekanntes Laufwerk'}</div>
                            <div class="drive-type">${drive.VolumeName || 'Kein Name'}</div>
                        </div>
                        <div class="drive-usage">
                            <div class="usage-bar">
                                <div class="usage-fill" style="width: ${usedPercentage}%; background-color: ${usedColor};"></div>
                            </div>
                            <div class="usage-text">${drive.UsedGB || 0} GB / ${drive.SizeGB || 0} GB (${usedPercentage}%)</div>
                        </div>
                        <div class="drive-details">
                            <div class="drive-detail">
                                <div class="detail-label">Freier Speicher</div>
                                <div class="detail-value">${drive.FreeGB || 0} GB</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Dateisystem</div>
                                <div class="detail-value">${drive.FileSystem || 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Seriennummer</div>
                                <div class="detail-value">${drive.VolumeSerialNumber || 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Anbieter</div>
                                <div class="detail-value">${drive.ProviderName || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            drivesHtml += '</div>';
            networkDrivesSection.innerHTML = drivesHtml;
        } else {
            networkDrivesSection.innerHTML = `
                <h3 class="detail-section-title"><i class="fas fa-network-wired"></i> Netzlaufwerke</h3>
                <div class="no-data">Keine Netzlaufwerk-Informationen verfügbar</div>
            `;
        }

        // Cloud-Laufwerke
        let cloudDrivesSection = document.createElement('div');
        cloudDrivesSection.className = 'detail-section';

        if (device.drives && device.drives.cloudDrives && device.drives.cloudDrives.length > 0) {
            let drivesHtml = '<h3 class="detail-section-title"><i class="fas fa-cloud"></i> Cloud-Laufwerke</h3><div class="drives-grid">';

            device.drives.cloudDrives.forEach((drive, index) => {
                const cloudIcon = getCloudIcon(drive.CloudProvider);

                drivesHtml += `
                    <div class="drive-card cloud-drive">
                        <div class="drive-header">
                            <div class="drive-name">${drive.DeviceID || 'Unbekanntes Laufwerk'}</div>
                            <div class="drive-type">${cloudIcon} ${drive.CloudProvider || 'Unbekannter Anbieter'}</div>
                        </div>
                        <div class="drive-details">
                            <div class="drive-detail">
                                <div class="detail-label">Status</div>
                                <div class="detail-value">${drive.SyncStatus || 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Letzte Synchronisation</div>
                                <div class="detail-value">${drive.LastSyncTime || 'N/A'}</div>
                            </div>
                            ${drive.AccountEmail ? `
                            <div class="drive-detail">
                                <div class="detail-label">Konto-E-Mail</div>
                                <div class="detail-value">${drive.AccountEmail || 'N/A'}</div>
                            </div>
                            ` : ''}
                            ${drive.InstallPath ? `
                            <div class="drive-detail">
                                <div class="detail-label">Installationspfad</div>
                                <div class="detail-value">${drive.InstallPath || 'N/A'}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            drivesHtml += '</div>';
            cloudDrivesSection.innerHTML = drivesHtml;
        } else {
            cloudDrivesSection.innerHTML = `
                <h3 class="detail-section-title"><i class="fas fa-cloud"></i> Cloud-Laufwerke</h3>
                <div class="no-data">Keine Cloud-Laufwerk-Informationen verfügbar</div>
            `;
        }

        // Weitere Laufwerke
        let otherDrivesSection = document.createElement('div');
        otherDrivesSection.className = 'detail-section';

        if (device.drives && device.drives.otherDrives && device.drives.otherDrives.length > 0) {
            let drivesHtml = '<h3 class="detail-section-title"><i class="fas fa-usb"></i> Weitere Laufwerke</h3><div class="drives-grid">';

            device.drives.otherDrives.forEach((drive, index) => {
                drivesHtml += `
                    <div class="drive-card">
                        <div class="drive-header">
                            <div class="drive-name">${drive.DeviceID || 'Unbekanntes Laufwerk'}</div>
                            <div class="drive-type">${drive.DriveType || 'Unbekannter Typ'}</div>
                        </div>
                        <div class="drive-details">
                            <div class="drive-detail">
                                <div class="detail-label">Name</div>
                                <div class="detail-value">${drive.VolumeName || 'Kein Name'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Größe</div>
                                <div class="detail-value">${drive.SizeGB ? `${drive.SizeGB} GB` : 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Freier Speicher</div>
                                <div class="detail-value">${drive.FreeGB ? `${drive.FreeGB} GB` : 'N/A'}</div>
                            </div>
                            <div class="drive-detail">
                                <div class="detail-label">Dateisystem</div>
                                <div class="detail-value">${drive.FileSystem || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            drivesHtml += '</div>';
            otherDrivesSection.innerHTML = drivesHtml;
        } else {
            otherDrivesSection.innerHTML = `
                <h3 class="detail-section-title"><i class="fas fa-usb"></i> Weitere Laufwerke</h3>
                <div class="no-data">Keine weiteren Laufwerk-Informationen verfügbar</div>
            `;
        }

        tabContent.appendChild(localDrivesSection);
        tabContent.appendChild(networkDrivesSection);
        tabContent.appendChild(cloudDrivesSection);
        tabContent.appendChild(otherDrivesSection);

        return tabContent;
    }

    // Funktion zum Erstellen des "Netzwerk"-Tabs
    function createNetworkTab(device) {
        const tabContent = document.createElement('div');
        tabContent.className = 'tab-content';

        if (device.network && Array.isArray(device.network) && device.network.length > 0) {
            let networkHtml = '<div class="network-grid">';

            device.network.forEach((net, index) => {
                const isActive = net.IPAddress && net.IPAddress !== 'N/A' && net.IPAddress !== '169.254.*';

                networkHtml += `
                    <div class="network-card ${isActive ? 'active' : 'inactive'}">
                        <div class="network-header">
                            <div class="network-name">${net.Description || 'Unbekannter Adapter'}</div>
                            <div class="network-status ${isActive ? 'connected' : 'disconnected'}">
                                <i class="fas fa-${isActive ? 'check-circle' : 'times-circle'}"></i>
                                ${isActive ? 'Verbunden' : 'Nicht verbunden'}
                            </div>
                        </div>
                        <div class="network-details">
                            <div class="network-detail">
                                <div class="detail-label">IP-Adresse</div>
                                <div class="detail-value">${net.IPAddress || 'N/A'}</div>
                            </div>
                            <div class="network-detail">
                                <div class="detail-label">MAC-Adresse</div>
                                <div class="detail-value">${net.MACAddress || 'N/A'}</div>
                            </div>
                            <div class="network-detail">
                                <div class="detail-label">Subnetzmaske</div>
                                <div class="detail-value">${net.SubnetMask || 'N/A'}</div>
                            </div>
                            <div class="network-detail">
                                <div class="detail-label">Standardgateway</div>
                                <div class="detail-value">${net.DefaultGateway || 'N/A'}</div>
                            </div>
                            <div class="network-detail">
                                <div class="detail-label">DNS-Server</div>
                                <div class="detail-value">${net.DNSServers || 'N/A'}</div>
                            </div>
                            <div class="network-detail">
                                <div class="detail-label">DHCP</div>
                                <div class="detail-value">${net.DHCPEnabled ? 'Aktiviert' : 'Deaktiviert'}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            networkHtml += '</div>';
            tabContent.innerHTML = networkHtml;
        } else {
            tabContent.innerHTML = `
                <div class="no-data">
                    <i class="fas fa-network-wired"></i>
                    <h3>Keine Netzwerkinformationen verfügbar</h3>
                    <p>Es konnten keine Netzwerkinformationen für dieses Gerät gefunden werden.</p>
                </div>
            `;
        }

        return tabContent;
    }

    // Hilfsfunktion zum Erstellen eines Status-Badges
    function getStatusBadge(status) {
        let statusBadge = '';
        let statusClass = '';

        switch (status) {
            case 'Verfügbar':
                statusBadge = 'Verfügbar';
                statusClass = 'status-available';
                break;
            case 'in Betrieb':
                statusBadge = 'In Betrieb';
                statusClass = 'status-active';
                break;
            case 'defekt':
                statusBadge = 'Defekt';
                statusClass = 'status-error';
                break;
            case 'in Reparatur':
                statusBadge = 'In Reparatur';
                statusClass = 'status-warning';
                break;
            case 'ausgemustert':
                statusBadge = 'Ausgemustert';
                statusClass = 'status-retired';
                break;
            default:
                statusBadge = status || 'Unbekannt';
                statusClass = 'status-unknown';
        }

        return `<span class="status-badge ${statusClass}">${statusBadge}</span>`;
    }

    // Hilfsfunktion zum Abrufen des Cloud-Icons
    function getCloudIcon(provider) {
        switch (provider) {
            case 'Microsoft OneDrive':
                return '<i class="fab fa-microsoft"></i>';
            case 'Google Drive':
                return '<i class="fab fa-google-drive"></i>';
            case 'Dropbox':
                return '<i class="fab fa-dropbox"></i>';
            case 'Apple iCloud':
                return '<i class="fab fa-apple"></i>';
            default:
                return '<i class="fas fa-cloud"></i>';
        }
    }

    function showEditDeviceModal(device) {
        // Befülle das Bearbeitungsformular mit den Gerätedaten
        document.getElementById('edit-device-assetId').value = device.assetNumber || '';
        document.getElementById('edit-device-serialNumber').value = device.serialNumber || '';
        document.getElementById('edit-device-manufacturer').value = device.manufacturer || '';
        document.getElementById('edit-device-model').value = device.model || '';
        document.getElementById('edit-device-status').value = device.status || 'Verfügbar';
        document.getElementById('edit-device-location').value = device.location || '';
        document.getElementById('edit-device-user').value = device.user || '';
        document.getElementById('edit-device-notes').value = device.notes || '';

        // Speichere die aktuelle Asset-Nummer für die Bearbeitung
        document.getElementById('edit-device-form').dataset.assetId = device.assetNumber;

        // Zeige das Bearbeitungsmodal
        document.getElementById('edit-device-modal').classList.add('active');
    }

    function setupConsoleConnection() {
        const consoleInitTime = document.getElementById('console-init-time');
        if (consoleInitTime) {
            const now = new Date();
            consoleInitTime.textContent = `[${now.toLocaleTimeString('de-DE')}]`;
        }

        const savedLogs = localStorage.getItem('consoleLog');
        if (savedLogs) {
            try {
                consoleLogData = JSON.parse(savedLogs);
                displayConsoleLogs();
                updateLogStatistics();
            } catch (e) {
                console.error('Fehler beim Laden der Console-Logs:', e);
            }
        }

        addConsoleMessage('Console wurde initialisiert', 'info');
    }

    function addConsoleMessage(message, type = 'info') {
        const timestamp = new Date().toISOString();
        const logEntry = { timestamp, type, message };
        consoleLogData.push(logEntry);

        localStorage.setItem('consoleLog', JSON.stringify(consoleLogData.slice(-1000)));

        if (document.getElementById('console').classList.contains('active')) {
            displayConsoleLogs();
        }
    }

    function displayConsoleLogs() {
        const consoleContent = document.getElementById('console-content');
        if (!consoleContent) return;

        consoleContent.innerHTML = '';
        const logsToShow = consoleLogData.slice(-100);

        logsToShow.forEach(log => {
            const logTime = new Date(log.timestamp);
            const messageElement = document.createElement('div');
            messageElement.className = 'console-message';
            messageElement.innerHTML = `<span class="console-timestamp">[${logTime.toLocaleTimeString('de-DE')}]</span><span class="console-${log.type}">${log.type.toUpperCase()}:</span> ${log.message}`;
            consoleContent.appendChild(messageElement);
        });

        consoleContent.scrollTop = consoleContent.scrollHeight;
    }

    function updateLogStatistics() {
        const logSize = new Blob([JSON.stringify(consoleLogData)]).size;
        document.getElementById('log-size').textContent = `${(logSize / 1024).toFixed(2)} KB`;
        document.getElementById('log-entries').textContent = consoleLogData.length;
        document.getElementById('log-last-update').textContent = new Date().toLocaleString('de-DE');
    }

    // --- NEUE FUNKTIONEN FÜR DIE IP-ADRESSEN-SEKTION ---

    /**
     * Lädt die IP-Adressen und initialisiert die Ansicht.
     */
    function loadIPAddresses() {
        if (!window.deviceData) return;
        updateIPAddresses(window.deviceData);

        const searchInput = document.getElementById('ip-search');
        if (searchInput) {
            // Entferne alte Event-Listener, um Duplikate zu vermeiden
            searchInput.removeEventListener('input', handleIPSearch);
            searchInput.addEventListener('input', handleIPSearch);
        }
    }

    /**
     * Reagiert auf Eingaben im Suchfeld und filtert die IP-Kacheln.
     * @param {Event} event - Das Input-Event.
     */
    function handleIPSearch(event) {
        const searchTerm = event.target.value.toLowerCase();
        const allTiles = document.querySelectorAll('.ip-tile');

        allTiles.forEach(tile => {
            const hostname = tile.dataset.hostname?.toLowerCase() || '';
            const assetNumber = tile.dataset.assetNumber?.toLowerCase() || '';
            const ipAddress = tile.dataset.ip?.toLowerCase() || '';

            if (hostname.includes(searchTerm) || assetNumber.includes(searchTerm) || ipAddress.includes(searchTerm)) {
                tile.classList.remove('hidden');
            } else {
                tile.classList.add('hidden');
            }
        });
    }

    /**
     * Aktualisiert die gesamte IP-Adressen-Ansicht mit den aktuellen Gerätedaten.
     * @param {Array} deviceData - Die aktuellen Gerätedaten.
     */
    function updateIPAddresses(deviceData) {
        const ipPoolsContainer = document.getElementById('ip-pools-container');
        if (!ipPoolsContainer) return;

        ipPoolsContainer.innerHTML = ''; // Alte Ansicht leeren

        const ipPools = detectIPPools(deviceData);
        let totalIPs = 0, usedIPs = 0;

        // Statistiken aktualisieren
        Object.values(ipPools).forEach(pool => {
            totalIPs += pool.range;
            usedIPs += pool.usedIPs;
        });

        document.getElementById('total-ips').textContent = totalIPs;
        document.getElementById('used-ips').textContent = usedIPs;
        document.getElementById('free-ips').textContent = totalIPs - usedIPs;

        if (Object.keys(ipPools).length === 0) {
            ipPoolsContainer.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> Keine IP-Adressen in den Gerätedaten gefunden.</div>`;
            return;
        }

        // Für jeden erkannten IP-Pool eine Karte erstellen
        Object.entries(ipPools).forEach(([network, pool]) => {
            const poolCard = createIPPoolCard(network, pool);
            ipPoolsContainer.appendChild(poolCard);
        });
    }

    /**
     * Erstellt eine einzelne Karte für einen IP-Pool.
     * @param {string} network - Die Netzwerkadresse (z.B. "192.168.1").
     * @param {object} pool - Das Pool-Objekt mit verwendeten IPs und Geräten.
     * @returns {HTMLElement} - Das fertige Karten-Element.
     */
    function createIPPoolCard(network, pool) {
        const poolCard = document.createElement('div');
        poolCard.className = 'ip-pool-card';

        const usagePercentage = pool.range > 0 ? Math.round((pool.usedIPs / pool.range) * 100) : 0;

        // Header mit Titel und Statistik
        poolCard.innerHTML = `
            <div class="ip-pool-header">
                <h3 class="ip-pool-title">${network}.0/${pool.subnet ? cidrFromSubnet(pool.subnet) : '24'}</h3>
                <div class="ip-pool-stats-header">${pool.usedIPs} / ${pool.range} IPs</div>
            </div>
            <div class="ip-pool-usage-bar-container">
                <div class="ip-pool-usage-bar">
                    <div class="ip-pool-usage-fill" style="width: ${usagePercentage}%"></div>
                </div>
                <div class="ip-pool-usage-text">
                    <span>${usagePercentage}% belegt</span>
                    <span>${pool.range - pool.usedIPs} frei</span>
                </div>
            </div>
            <div class="ip-pool-content">
                <div class="ip-grid" id="ip-grid-${network.replace(/\./g, '-')}">
                    <!-- IP-Kacheln werden hier per JavaScript eingefügt -->
                </div>
            </div>
        `;

        const ipGrid = poolCard.querySelector(`#ip-grid-${network.replace(/\./g, '-')}`);

        // Kacheln für alle IPs im Pool erstellen (von .1 bis .254)
        for (let i = 1; i <= 254; i++) {
            const ip = `${network}.${i}`;
            const device = pool.devices.find(d => d.ips.has(ip));
            const tile = createIPTile(ip, device);
            ipGrid.appendChild(tile);
        }

        return poolCard;
    }

    /**
     * Erstellt eine einzelne IP-Kachel.
     * @param {string} ip - Die IP-Adresse.
     * @param {object|null} device - Das zugehörige Gerät, wenn die IP vergeben ist.
     * @returns {HTMLElement} - Das fertige Kachel-Element.
     */
    function createIPTile(ip, device) {
        const tile = document.createElement('div');
        tile.className = 'ip-tile';
        tile.dataset.ip = ip;

        if (device) {
            tile.classList.add('used');
            tile.dataset.hostname = device.hostname;
            tile.dataset.assetNumber = device.assetNumber;
            tile.innerHTML = `
                <div>${device.hostname || 'N/A'}</div>
                <div class="ip-address">${ip}</div>
            `;
            tile.addEventListener('click', () => showDeviceDetails(device));
        } else {
            tile.classList.add('free');
            tile.innerHTML = `
                <div>Frei</div>
                <div class="ip-address">${ip}</div>
            `;
            tile.addEventListener('click', () => showAddIPModal(ip));
        }

        return tile;
    }

    /**
     * Verbesserte Funktion zum Erkennen von IP-Pools.
     * @param {Array} deviceData - Die Gerätedaten.
     * @returns {object} - Ein Objekt, das die erkannten Pools enthält.
     */
    function detectIPPools(deviceData) {
        const pools = {};
        deviceData.forEach(device => {
            if (device.network && Array.isArray(device.network)) {
                device.network.forEach(net => {
                    if (net.IPAddress) {
                        const match = net.IPAddress.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);
                        if (match) {
                            const network = `${match[1]}.${match[2]}.${match[3]}`;
                            if (!pools[network]) {
                                pools[network] = {
                                    network: network + '.0',
                                    subnet: net.IPSubnet || '255.255.255.0',
                                    range: 254, // Annahme: /24 Netzwerk
                                    usedIPs: 0,
                                    devices: []
                                };
                            }
                            
                            // IPs des Geräts als Set für schnellen Lookup speichern
                            if (!device.ips) device.ips = new Set();
                            device.ips.add(net.IPAddress);

                            // Gerät nur einmal pro Pool hinzufügen
                            if (!pools[network].devices.some(d => d.assetNumber === device.assetNumber)) {
                                pools[network].devices.push(device);
                            }
                        }
                    }
                });
            }
        });

        // Zähle die einzigartigen verwendeten IPs pro Pool
        Object.values(pools).forEach(pool => {
            const uniqueIPs = new Set();
            pool.devices.forEach(device => {
                device.network.forEach(net => {
                    if (net.IPAddress && net.IPAddress.startsWith(pool.network.substring(0, pool.network.lastIndexOf('.')))) {
                        uniqueIPs.add(net.IPAddress);
                    }
                });
            });
            pool.usedIPs = uniqueIPs.size;
        });

        return pools;
    }

    /**
     * Zeigt das "IP hinzufügen"-Modal an und füllt die IP-Adresse vor.
     * @param {string} ip - Die vorzufüllende IP-Adresse.
     */
    function showAddIPModal(ip) {
        const modal = document.getElementById('add-ip-modal');
        const ipInput = document.getElementById('new-ip-address');
        
        if (modal && ipInput) {
            ipInput.value = ip;
            modal.classList.add('active');
        }
    }

    /**
     * Handler für das Hinzufügen einer neuen IP-Adresse.
     * @param {Event} e - Das Submit-Event des Formulars.
     */
    function handleAddIP(e) {
        e.preventDefault();
        // Die eigentliche Logik zum Speichern der IP würde hier stehen.
        // Für jetzt zeigen wir nur eine Erfolgsmeldung.
        const ip = document.getElementById('new-ip-address').value;
        showNotification('Erfolg', `IP-Adresse ${ip} wurde (simuliert) hinzugefügt.`, 'success');
        document.getElementById('add-ip-modal').classList.remove('active');
        
        // Optional: Daten neu laden, um die neue IP anzuzeigen
        // loadDeviceData().then(() => loadIPAddresses());
    }

    /**
     * Hilfsfunktion, um eine Subnetzmaske in CIDR-Notation umzuwandeln.
     * @param {string} subnet - Die Subnetzmaske (z.B. "255.255.255.0").
     * @returns {number} - Die CIDR-Notation (z.B. 24).
     */
    function cidrFromSubnet(subnet) {
        if (!subnet) return 24;
        const parts = subnet.split('.').map(Number);
        let cidr = 0;
        for (const part of parts) {
            if (part === 255) {
                cidr += 8;
            } else {
                let binary = part.toString(2);
                cidr += binary.split('1').length - 1;
                break;
            }
        }
        return cidr;
    }

    function applyFilters() {
        if (!window.deviceData) return;
        let filteredData = [...window.deviceData];

        if (currentFilters.status) filteredData = filteredData.filter(device => device.status && device.status.includes(currentFilters.status));
        if (currentFilters.manufacturer) filteredData = filteredData.filter(device => device.manufacturer && device.manufacturer.includes(currentFilters.manufacturer));
        if (currentFilters.location) filteredData = filteredData.filter(device => device.location && device.location.includes(currentFilters.location));
        if (currentFilters.search) {
            const search = currentFilters.search.toLowerCase();
            filteredData = filteredData.filter(device =>
                (device.assetNumber && device.assetNumber.toLowerCase().includes(search)) ||
                (device.hostname && device.hostname.toLowerCase().includes(search)) ||
                (device.user && device.user.toLowerCase().includes(search)) ||
                (device.serialNumber && device.serialNumber.toLowerCase().includes(search))
            );
        }

        switch (currentFilters.sort) {
            case 'assetNumber': filteredData.sort((a, b) => (a.assetNumber || '').localeCompare(b.assetNumber || '')); break;
            case 'assetNumber-desc': filteredData.sort((a, b) => (b.assetNumber || '').localeCompare(a.assetNumber || '')); break;
            case 'hostname': filteredData.sort((a, b) => (a.hostname || '').localeCompare(b.hostname || '')); break;
            case 'hostname-desc': filteredData.sort((a, b) => (b.hostname || '').localeCompare(a.hostname || '')); break;
            case 'timestamp': filteredData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); break;
            case 'timestamp-oldest': filteredData.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)); break;
        }

        updateDevicesTable(filteredData);
    }

    function updateActiveFiltersDisplay() {
        const container = document.getElementById('active-filters');
        container.innerHTML = '';

        // Hilfsfunktion zum Erstellen und Hinzufügen eines Badges
        const addBadge = (label, value, filterElementId) => {
            const badge = document.createElement('div');
            badge.className = 'filter-badge';
            // Wir verwenden jetzt die feste ID des HTML-Elements
            badge.innerHTML = `${label}: ${value} <i class="fas fa-times" data-filter-id="${filterElementId}"></i>`;
            container.appendChild(badge);

            // Event-Listener für das 'x'-Icon
            badge.querySelector('.fa-times').addEventListener('click', () => {
                // 1. Das korrekte Formular-Element anhand seiner ID finden und leeren
                const elementToClear = document.getElementById(filterElementId);
                if (elementToClear) {
                    elementToClear.value = '';
                }

                // 2. Den entsprechenden Wert im currentFilters-Objekt zurücksetzen
                // Wir leiten den Property-Namen von der ID ab (z.B. "filter-manufacturer" -> "manufacturer")
                const propertyName = filterElementId.replace('filter-', '');
                currentFilters[propertyName] = '';

                // 3. DAS BADGE SOFORT ENTFERNEN für sofortige visuelle Rückmeldung
                badge.remove();

                // 4. Filter neu anwenden, um die Tabelle zu aktualisieren
                applyFilters();
            });
        };

        if (currentFilters.status) addBadge('Status', currentFilters.status, 'filter-status');
        if (currentFilters.manufacturer) addBadge('Hersteller', currentFilters.manufacturer, 'filter-manufacturer');
        if (currentFilters.location) addBadge('Standort', currentFilters.location, 'filter-location');
        if (currentFilters.search) addBadge('Suche', `"${currentFilters.search}"`, 'filter-search');
    }

    function generateReport() {
        const reportType = document.getElementById('report-type').value;
        const reportContent = document.getElementById('report-content');
        reportContent.innerHTML = '';

        let reportData = {};

        switch (reportType) {
            case 'overview':
                // Übersichtsreport
                reportData.title = 'Geräteübersicht';
                reportData.sections = [
                    {
                        title: 'Geräte nach Hersteller',
                        type: 'chart',
                        data: getManufacturerData()
                    },
                    {
                        title: 'Geräte nach Status',
                        type: 'chart',
                        data: getDeviceStatusData()
                    },
                    {
                        title: 'Betriebssystemverteilung',
                        type: 'chart',
                        data: getOSData()
                    }
                ];
                break;

            case 'by-type':
                // Report nach Gerätetyp
                reportData.title = 'Geräte nach Typ';
                reportData.sections = [
                    {
                        title: 'Geräte nach Typ',
                        type: 'table',
                        data: getDeviceTypeTableData()
                    }
                ];
                break;

            case 'by-status':
                // Report nach Status
                reportData.title = 'Geräte nach Status';
                reportData.sections = [
                    {
                        title: 'Geräte nach Status',
                        type: 'table',
                        data: getDeviceStatusTableData()
                    }
                ];
                break;

            case 'by-location':
                // Report nach Standort
                reportData.title = 'Geräte nach Standort';
                reportData.sections = [
                    {
                        title: 'Geräte nach Standort',
                        type: 'table',
                        data: getLocationTableData()
                    }
                ];
                break;

            case 'by-manufacturer':
                // Report nach Hersteller
                reportData.title = 'Geräte nach Hersteller';
                reportData.sections = [
                    {
                        title: 'Geräte nach Hersteller',
                        type: 'table',
                        data: getManufacturerTableData()
                    }
                ];
                break;

            case 'by-user':
                // Report nach Benutzer
                reportData.title = 'Geräte nach Benutzer';
                reportData.sections = [
                    {
                        title: 'Geräte nach Benutzer',
                        type: 'table',
                        data: getUserTableData()
                    }
                ];
                break;

            case 'aging':
                // Gerätealterung
                reportData.title = 'Gerätealterung';
                reportData.sections = [
                    {
                        title: 'Gerätealterung',
                        type: 'table',
                        data: getAgingTableData()
                    }
                ];
                break;

            case 'warranty':
                // Garantie-Übersicht
                reportData.title = 'Garantie-Übersicht';
                reportData.sections = [
                    {
                        title: 'Garantie-Übersicht',
                        type: 'table',
                        data: getWarrantyTableData()
                    }
                ];
                break;

            case 'inventory':
                // Inventarliste
                reportData.title = 'Inventarliste';
                reportData.sections = [
                    {
                        title: 'Inventarliste',
                        type: 'table',
                        data: getInventoryTableData()
                    }
                ];
                break;
        }

        // Report-Inhalt generieren
        const reportTitle = document.createElement('h3');
        reportTitle.className = 'report-section-title';
        reportTitle.textContent = reportData.title;
        reportContent.appendChild(reportTitle);

        reportData.sections.forEach(section => {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'report-section';

            const sectionTitle = document.createElement('h4');
            sectionTitle.className = 'report-section-title';
            sectionTitle.textContent = section.title;
            sectionDiv.appendChild(sectionTitle);

            if (section.type === 'chart') {
                // Chart erstellen
                const chartContainer = document.createElement('div');
                chartContainer.className = 'report-chart';
                chartContainer.style.height = '300px';
                sectionDiv.appendChild(chartContainer);

                const canvas = document.createElement('canvas');
                chartContainer.appendChild(canvas);

                // Chart-Daten basierend auf dem Typ
                let chartData, chartOptions;

                if (section.title === 'Geräte nach Hersteller') {
                    chartData = {
                        labels: Object.keys(section.data),
                        datasets: [{
                            data: Object.values(section.data),
                            backgroundColor: ['#FF7700', '#FF9838', '#FFB870', '#FFD8B8', '#4299E1', '#48BB78'],
                            borderWidth: 1
                        }]
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    };
                } else if (section.title === 'Geräte nach Status') {
                    chartData = {
                        labels: Object.keys(section.data),
                        datasets: [{
                            data: Object.values(section.data),
                            backgroundColor: [
                                '#48BB78', // Verfügbar - Grün
                                '#F56565', // In Betrieb - Rot
                                '#8B0000', // Defekt - Dunkelrot
                                '#ECC94B', // In Reparatur - Orange
                                '#9F7AEA'  // Ausgemustert - Lila
                            ],
                            borderWidth: 1
                        }]
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    };
                } else if (section.title === 'Betriebssystemverteilung') {
                    chartData = {
                        labels: Object.keys(section.data),
                        datasets: [{
                            data: Object.values(section.data),
                            backgroundColor: ['#FF7700', '#4299E1', '#48BB78', '#ECC94B', '#9F7AEA'],
                            borderWidth: 1
                        }]
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    };
                }

                new Chart(canvas, {
                    type: 'doughnut',
                    data: chartData,
                    options: chartOptions
                });
            } else if (section.type === 'table') {
                // Tabelle erstellen
                const table = document.createElement('table');
                table.className = 'report-table';

                // Tabellenkopf
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                section.data.headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Tabelleninhalt
                const tbody = document.createElement('tbody');
                section.data.rows.forEach(row => {
                    const tr = document.createElement('tr');
                    row.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                table.appendChild(tbody);

                sectionDiv.appendChild(table);
            }

            reportContent.appendChild(sectionDiv);
        });

        showNotification('Erfolg', 'Report wurde erfolgreich generiert', 'success');
    }

    function updateReportOptions() {
        const reportType = document.getElementById('report-type').value;
        const reportOptions = document.getElementById('report-options');
        reportOptions.innerHTML = '';

        switch (reportType) {
            case 'aging':
                // Optionen für Gerätealterung
                const agingOptions = document.createElement('div');
                agingOptions.className = 'report-options';
                agingOptions.innerHTML = `
                    <div class="report-option">
                        <label for="aging-threshold">Alter in Jahren:</label>
                        <input type="number" id="aging-threshold" min="1" max="10" value="3" class="filter-input">
                    </div>
                    <div class="report-option">
                        <label for="aging-comparison">Vergleich mit:</label>
                        <select id="aging-comparison" class="filter-select">
                            <option value="purchase-date">Kaufdatum</option>
                            <option value="warranty-expiry">Garantieende</option>
                        </select>
                    </div>
                `;
                reportOptions.appendChild(agingOptions);
                break;

            case 'warranty':
                // Optionen für Garantie-Übersicht
                const warrantyOptions = document.createElement('div');
                warrantyOptions.className = 'report-options';
                warrantyOptions.innerHTML = `
                    <div class="report-option">
                        <label for="warranty-period">Zeitraum in Monaten:</label>
                        <input type="number" id="warranty-period" min="1" max="60" value="12" class="filter-input">
                    </div>
                    <div class="report-option">
                        <label for="warranty-status">Status:</label>
                        <select id="warranty-status" class="filter-select">
                            <option value="all">Alle</option>
                            <option value="expiring">Bald ablaufend</option>
                            <option value="expired">Abgelaufen</option>
                        </select>
                    </div>
                `;
                reportOptions.appendChild(warrantyOptions);
                break;

            case 'inventory':
                // Optionen für Inventarliste
                const inventoryOptions = document.createElement('div');
                inventoryOptions.className = 'report-options';
                inventoryOptions.innerHTML = `
                    <div class="report-option">
                        <label for="inventory-fields">Felder:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-assetNumber" checked> Asset-Nummer
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-hostname" checked> Hostname
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-deviceType" checked> Gerätetyp
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-status" checked> Status
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-user" checked> Benutzer
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-location" checked> Standort
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-manufacturer"> Hersteller
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-model"> Modell
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-purchaseDate"> Kaufdatum
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="field-warrantyExpiry"> Garantie bis
                            </label>
                        </div>
                    </div>
                `;
                reportOptions.appendChild(inventoryOptions);
                break;
        }
    }

    function getManufacturerData() {
        const manufacturerCounts = {};
        window.deviceData.forEach(device => {
            if (device.manufacturer) {
                manufacturerCounts[device.manufacturer] = (manufacturerCounts[device.manufacturer] || 0) + 1;
            }
        });
        return manufacturerCounts;
    }

    function getDeviceStatusData() {
        const statusCounts = {};
        window.deviceData.forEach(device => {
            if (device.status) {
                statusCounts[device.status] = (statusCounts[device.status] || 0) + 1;
            }
        });
        return statusCounts;
    }

    function getOSData() {
        const osCounts = {};
        window.deviceData.forEach(device => {
            if (device.os) {
                osCounts[device.os] = (osCounts[device.os] || 0) + 1;
            }
        });
        return osCounts;
    }

    function getDeviceTypeTableData() {
        const deviceTypeCounts = {};
        window.deviceData.forEach(device => {
            if (device.deviceType) {
                deviceTypeCounts[device.deviceType] = (deviceTypeCounts[device.deviceType] || 0) + 1;
            }
        });

        const headers = ['Gerätetyp', 'Anzahl'];
        const rows = Object.entries(deviceTypeCounts).map(([type, count]) => [type, count.toString()]);

        return { headers, rows };
    }

    function getDeviceStatusTableData() {
        const statusCounts = {};
        window.deviceData.forEach(device => {
            if (device.status) {
                statusCounts[device.status] = (statusCounts[device.status] || 0) + 1;
            }
        });

        const headers = ['Status', 'Anzahl'];
        const rows = Object.entries(statusCounts).map(([status, count]) => [status, count.toString()]);

        return { headers, rows };
    }

    function getLocationTableData() {
        const locationCounts = {};
        window.deviceData.forEach(device => {
            if (device.location) {
                locationCounts[device.location] = (locationCounts[device.location] || 0) + 1;
            }
        });

        const headers = ['Standort', 'Anzahl'];
        const rows = Object.entries(locationCounts).map(([location, count]) => [location, count.toString()]);

        return { headers, rows };
    }

    function getManufacturerTableData() {
        const manufacturerCounts = {};
        window.deviceData.forEach(device => {
            if (device.manufacturer) {
                manufacturerCounts[device.manufacturer] = (manufacturerCounts[device.manufacturer] || 0) + 1;
            }
        });

        const headers = ['Hersteller', 'Anzahl'];
        const rows = Object.entries(manufacturerCounts).map(([manufacturer, count]) => [manufacturer, count.toString()]);

        return { headers, rows };
    }

    function getUserTableData() {
        const userCounts = {};
        window.deviceData.forEach(device => {
            if (device.user) {
                userCounts[device.user] = (userCounts[device.user] || 0) + 1;
            }
        });

        const headers = ['Benutzer', 'Anzahl Geräte'];
        const rows = Object.entries(userCounts).map(([user, count]) => [user, count.toString()]);

        return { headers, rows };
    }

    function getAgingTableData() {
        const threshold = document.getElementById('aging-threshold') ? parseInt(document.getElementById('aging-threshold').value) : 3;
        const comparison = document.getElementById('aging-comparison') ? document.getElementById('aging-comparison').value : 'purchase-date';
        const currentDate = new Date();
        const thresholdDate = new Date();
        thresholdDate.setFullYear(currentDate.getFullYear() - threshold);

        const headers = ['Asset-Nummer', 'Hostname', 'Gerätetyp', comparison === 'purchase-date' ? 'Kaufdatum' : 'Garantie bis', 'Alter (Jahre)'];
        const rows = [];

        window.deviceData.forEach(device => {
            const dateStr = comparison === 'purchase-date' ? device.purchaseDate : device.warrantyExpiry;
            if (dateStr) {
                const date = new Date(dateStr);
                const ageInYears = Math.floor((currentDate - date) / (365.25 * 24 * 60 * 60 * 1000));

                if (ageInYears >= threshold) {
                    rows.push([
                        device.assetNumber || '-',
                        device.hostname || '-',
                        device.deviceType || '-',
                        dateStr,
                        ageInYears.toString()
                    ]);
                }
            }
        });

        return { headers, rows };
    }

    function getWarrantyTableData() {
        const period = document.getElementById('warranty-period') ? parseInt(document.getElementById('warranty-period').value) : 12;
        const status = document.getElementById('warranty-status') ? document.getElementById('warranty-status').value : 'all';
        const currentDate = new Date();
        const periodDate = new Date();
        periodDate.setMonth(currentDate.getMonth() + period);

        const headers = ['Asset-Nummer', 'Hostname', 'Gerätetyp', 'Garantie bis', 'Tage bis Garantieende'];
        const rows = [];

        window.deviceData.forEach(device => {
            if (device.warrantyExpiry) {
                const warrantyDate = new Date(device.warrantyExpiry);
                const daysUntilExpiry = Math.floor((warrantyDate - currentDate) / (24 * 60 * 60 * 1000));

                if ((status === 'all') ||
                    (status === 'expiring' && daysUntilExpiry > 0 && daysUntilExpiry <= period * 30) ||
                    (status === 'expired' && daysUntilExpiry < 0)) {
                    rows.push([
                        device.assetNumber || '-',
                        device.hostname || '-',
                        device.deviceType || '-',
                        device.warrantyExpiry,
                        daysUntilExpiry.toString()
                    ]);
                }
            }
        });

        return { headers, rows };
    }

    function getInventoryTableData() {
        const headers = [];
        const rows = [];

        // Bestimme die ausgewählten Felder
        const selectedFields = [];
        if (document.getElementById('field-assetNumber') && document.getElementById('field-assetNumber').checked) selectedFields.push('assetNumber');
        if (document.getElementById('field-hostname') && document.getElementById('field-hostname').checked) selectedFields.push('hostname');
        if (document.getElementById('field-deviceType') && document.getElementById('field-deviceType').checked) selectedFields.push('deviceType');
        if (document.getElementById('field-status') && document.getElementById('field-status').checked) selectedFields.push('status');
        if (document.getElementById('field-user') && document.getElementById('field-user').checked) selectedFields.push('user');
        if (document.getElementById('field-location') && document.getElementById('field-location').checked) selectedFields.push('location');
        if (document.getElementById('field-manufacturer') && document.getElementById('field-manufacturer').checked) selectedFields.push('manufacturer');
        if (document.getElementById('field-model') && document.getElementById('field-model').checked) selectedFields.push('model');
        if (document.getElementById('field-purchaseDate') && document.getElementById('field-purchaseDate').checked) selectedFields.push('purchaseDate');
        if (document.getElementById('field-warrantyExpiry') && document.getElementById('field-warrantyExpiry').checked) selectedFields.push('warrantyExpiry');

        // Übersetzungen für Feldnamen
        const fieldTranslations = {
            assetNumber: 'Asset-Nummer',
            hostname: 'Hostname',
            deviceType: 'Gerätetyp',
            status: 'Status',
            user: 'Benutzer',
            location: 'Standort',
            manufacturer: 'Hersteller',
            model: 'Modell',
            purchaseDate: 'Kaufdatum',
            warrantyExpiry: 'Garantie bis'
        };

        // Erstelle Header
        selectedFields.forEach(field => {
            headers.push(fieldTranslations[field] || field);
        });

        // Erstelle Zeilen
        window.deviceData.forEach(device => {
            const row = [];
            selectedFields.forEach(field => {
                row.push(device[field] || '-');
            });
            rows.push(row);
        });

        return { headers, rows };
    }

    function exportReport() {
        const reportType = document.getElementById('report-type').value;
        let exportData = [];
        let fileName = '';

        switch (reportType) {
            case 'overview':
                // Übersichtsreport exportieren
                exportData = [
                    ['Hersteller', 'Anzahl'],
                    ...Object.entries(getManufacturerData()),
                    ['', ''],
                    ['Status', 'Anzahl'],
                    ...Object.entries(getDeviceStatusData()),
                    ['', ''],
                    ['Betriebssystem', 'Anzahl'],
                    ...Object.entries(getOSData())
                ];
                fileName = 'geraeteuebersicht';
                break;

            case 'by-type':
                // Report nach Gerätetyp exportieren
                const deviceTypeTableData = getDeviceTypeTableData();
                exportData = [deviceTypeTableData.headers, ...deviceTypeTableData.rows];
                fileName = 'geraete-nach-typ';
                break;

            case 'by-status':
                // Report nach Status exportieren
                const deviceStatusTableData = getDeviceStatusTableData();
                exportData = [deviceStatusTableData.headers, ...deviceStatusTableData.rows];
                fileName = 'geraete-nach-status';
                break;

            case 'by-location':
                // Report nach Standort exportieren
                const locationTableData = getLocationTableData();
                exportData = [locationTableData.headers, ...locationTableData.rows];
                fileName = 'geraete-nach-standort';
                break;

            case 'by-manufacturer':
                // Report nach Hersteller exportieren
                const manufacturerTableData = getManufacturerTableData();
                exportData = [manufacturerTableData.headers, ...manufacturerTableData.rows];
                fileName = 'geraete-nach-hersteller';
                break;

            case 'by-user':
                // Report nach Benutzer exportieren
                const userTableData = getUserTableData();
                exportData = [userTableData.headers, ...userTableData.rows];
                fileName = 'geraete-nach-benutzer';
                break;

            case 'aging':
                // Gerätealterung exportieren
                const agingTableData = getAgingTableData();
                exportData = [agingTableData.headers, ...agingTableData.rows];
                fileName = 'geraetealterung';
                break;

            case 'warranty':
                // Garantie-Übersicht exportieren
                const warrantyTableData = getWarrantyTableData();
                exportData = [warrantyTableData.headers, ...warrantyTableData.rows];
                fileName = 'garantieuebersicht';
                break;

            case 'inventory':
                // Inventarliste exportieren
                const inventoryTableData = getInventoryTableData();
                exportData = [inventoryTableData.headers, ...inventoryTableData.rows];
                fileName = 'inventarliste';
                break;
        }

        // Excel-Datei erstellen und herunterladen
        const ws = XLSX.utils.aoa_to_sheet(exportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Report');
        XLSX.writeFile(wb, `${fileName}_${new Date().toISOString().slice(0, 10)}.xlsx`);

        showNotification('Erfolg', 'Report wurde erfolgreich exportiert', 'success');
    }

    function updateReportSection() {
        // Initialen Report generieren
        generateReport();
    }

    // --- HANDLER FÜR BUTTONS & AKTIONEN ---

    function handleRefreshData() {
        // Füge visuelles Feedback hinzu
        const refreshBtn = document.getElementById('refresh-data');
        const icon = refreshBtn.querySelector('i');

        // Deaktiviere den Button während des Ladens
        refreshBtn.disabled = true;
        icon.classList.add('fa-spin');

        // Zeige eine Benachrichtigung, dass die Aktualisierung gestartet wurde
        showNotification('Info', 'Daten werden aktualisiert...', 'info');

        // Lade die Daten neu mit Cache-Busting, um sicherzustellen, dass wir die neuesten Daten erhalten
        const timestamp = new Date().getTime();
        fetch(`api/devices?t=${timestamp}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Netzwerkantwort war nicht ok');
                }
                return response.json();
            })
            .then(data => {
                // Stelle sicher, dass die Netzwerkdaten korrekt formatiert sind
                window.deviceData = data.map(device => {
                    if (!device.network) device.network = [];
                    else if (!Array.isArray(device.network) && device.network.IPAddress) {
                        device.network = [device.network];
                    }
                    return device;
                });

                // Speichere die Daten im localStorage für Offline-Zugriff
                localStorage.setItem('deviceData', JSON.stringify(window.deviceData));

                // Überprüfe, welcher Abschnitt aktuell aktiv ist und aktualisiere entsprechend
                const activeSection = document.querySelector('.dashboard-section.active').id;

                // Aktualisiere die grundlegenden Statistiken
                if (window.deviceData) {
                    updateStatistics(window.deviceData);

                    // Aktualisiere den Dashboard-Bereich
                    if (activeSection === 'dashboard') {
                        createDashboardCharts(window.deviceData);
                        updateDashboardTable(window.deviceData);
                    }
                    // Aktualisiere die Gerätetabelle, falls der Gerätebereich aktiv ist
                    else if (activeSection === 'devices') {
                        updateDevicesTable(window.deviceData);
                    }
                    // Aktualisiere die IP-Adressen, falls der IP-Bereich aktiv ist
                    else if (activeSection === 'ip-addresses') {
                        updateIPAddresses(window.deviceData);
                    }
                    // Aktualisiere den Report, falls der Report-Bereich aktiv ist
                    else if (activeSection === 'reports') {
                        updateReportSection();
                    }

                    // Aktualisiere die Info-Karte im Einstellungsbereich
                    if (activeSection === 'settings') {
                        updateInfoCard();
                    }

                    // Zeige eine Erfolgsbenachrichtigung
                    showNotification('Erfolg', 'Daten wurden erfolgreich aktualisiert', 'success');

                    // Füge eine Nachricht zur Konsole hinzu
                    addConsoleMessage('Daten wurden aktualisiert', 'success');
                } else {
                    // Zeige eine Fehlerbenachrichtigung, wenn keine Daten geladen werden konnten
                    showNotification('Fehler', 'Keine Daten konnten geladen werden', 'error');
                    addConsoleMessage('Fehler beim Aktualisieren der Daten', 'error');
                }

                // Reaktiviere den Button und entferne die Animation
                refreshBtn.disabled = false;
                icon.classList.remove('fa-spin');
            })
            .catch(error => {
                console.error('Fehler beim Aktualisieren der Daten:', error);

                // Zeige eine Fehlerbenachrichtigung
                showNotification('Fehler', 'Daten konnten nicht aktualisiert werden: ' + error.message, 'error');

                // Füge eine Fehlermeldung zur Konsole hinzu
                addConsoleMessage('Fehler beim Aktualisieren: ' + error.message, 'error');

                // Reaktiviere den Button und entferne die Animation
                refreshBtn.disabled = false;
                icon.classList.remove('fa-spin');
            });
    }

    function handleAddDevice(e) {
        e.preventDefault();
        
        // Generiere eine 8-stellige Asset-Nummer (Zahlen und Großbuchstaben)
        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        let assetNumber = '';
        for (let i = 0; i < 8; i++) {
            assetNumber += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        // Sammle alle Formulardaten
        const deviceType = document.querySelector('.asset-type-btn.active').getAttribute('data-type');
        const newDevice = {
            assetNumber: assetNumber,
            hostname: document.getElementById('new-device-hostname').value,
            deviceType: deviceType,
            serialNumber: document.getElementById('new-device-serialNumber').value,
            manufacturer: document.getElementById('new-device-manufacturer').value,
            model: document.getElementById('new-device-model').value,
            status: document.getElementById('new-device-status').value,
            location: document.getElementById('new-device-location').value,
            user: document.getElementById('new-device-user').value,
            notes: document.getElementById('new-device-notes').value,
            purchaseDate: new Date().toISOString().split('T')[0], // Heutiges Datum
            warrantyExpiry: new Date(new Date().setFullYear(new Date().getFullYear() + 3)).toISOString().split('T')[0], // 3 Jahre Garantie
            timestamp: new Date().toISOString(),
            lastModified: new Date().toISOString(),
            modifiedBy: 'admin'
        };
        
        // Gerätetyp-spezifische Daten hinzufügen
        if (['laptop', 'pc', 'tablet', 'smartphone'].includes(deviceType)) {
            newDevice.os = document.getElementById('new-device-os').value;
            newDevice.cpu = document.getElementById('new-device-cpu').value;
            newDevice.ramGB = parseInt(document.getElementById('new-device-ramGB').value) || 0;
            newDevice.cores = parseInt(document.getElementById('new-device-cores').value) || 0;
            newDevice.logicalProc = parseInt(document.getElementById('new-device-logicalProc').value) || 0;
            
            // Speicherinformationen sammeln
            newDevice.storage = [];
            document.querySelectorAll('#storage-entries .storage-entry').forEach(entry => {
                const type = entry.querySelector('input[name="storageType"]').value;
                const size = parseInt(entry.querySelector('input[name="storageSize"]').value) || 0;
                const interface = entry.querySelector('input[name="storageInterface"]').value;
                
                if (type && size > 0) {
                    newDevice.storage.push({ type, size, interface });
                }
            });
            
            // Netzwerkinformationen sammeln
            newDevice.network = [];
            document.querySelectorAll('#network-entries .network-entry').forEach(entry => {
                const ip = entry.querySelector('input[name="ip"]').value;
                const mac = entry.querySelector('input[name="mac"]').value;
                const subnet = entry.querySelector('input[name="subnet"]').value;
                
                if (ip && mac) {
                    newDevice.network.push({ IPAddress: ip, MACAddress: mac, IPSubnet: subnet });
                }
            });
        } else if (deviceType === 'server') {
            newDevice.os = document.getElementById('new-device-os').value;
            newDevice.cpu = document.getElementById('new-device-cpu').value;
            newDevice.ramGB = parseInt(document.getElementById('new-device-ramGB').value) || 0;
            newDevice.rack = document.getElementById('new-device-rack').value;
            newDevice.slot = document.getElementById('new-device-slot').value;
            newDevice.operationClass = document.getElementById('new-device-operationClass').value;
            newDevice.itResponsible = document.getElementById('new-device-itResponsible').value;
            
            // Netzwerkinformationen sammeln
            newDevice.network = [];
            document.querySelectorAll('#server-network-entries .network-entry').forEach(entry => {
                const ip = entry.querySelector('input[name="ip"]').value;
                const mac = entry.querySelector('input[name="mac"]').value;
                const subnet = entry.querySelector('input[name="subnet"]').value;
                
                if (ip && mac) {
                    newDevice.network.push({ IPAddress: ip, MACAddress: mac, IPSubnet: subnet });
                }
            });
        } else if (['switch', 'firewall', 'ap'].includes(deviceType)) {
            newDevice.firmware = document.getElementById('new-device-firmware').value;
            newDevice.portCount = parseInt(document.getElementById('new-device-portCount').value) || 0;
            newDevice.networkLocation = document.getElementById('new-device-networkLocation').value;
            newDevice.itResponsible = document.getElementById('new-device-itResponsible').value;
            
            // Netzwerkinformationen sammeln
            newDevice.network = [];
            document.querySelectorAll('#network-device-network-entries .network-entry').forEach(entry => {
                const ip = entry.querySelector('input[name="ip"]').value;
                const mac = entry.querySelector('input[name="mac"]').value;
                const subnet = entry.querySelector('input[name="subnet"]').value;
                
                if (ip && mac) {
                    newDevice.network.push({ IPAddress: ip, MACAddress: mac, IPSubnet: subnet });
                }
            });
        } else if (['monitor', 'printer'].includes(deviceType)) {
            newDevice.connection = document.getElementById('new-device-connection').value;
            newDevice.resolution = document.getElementById('new-device-resolution').value;
        }
        
        // Sende die Daten an den Server
        fetch('/api/devices', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newDevice)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Netzwerkantwort war nicht ok');
            }
            return response.json();
        })
        .then(result => {
            showNotification('Erfolg', result.message, 'success');
            addConsoleMessage(`Neues Gerät ${newDevice.assetNumber} wurde hinzugefügt`, 'success');
            document.getElementById('add-device-modal').classList.remove('active');
            
            // Daten neu laden und UI aktualisieren
            loadDeviceData().then(() => {
                if (document.getElementById('devices').classList.contains('active')) {
                    updateDevicesTable(window.deviceData);
                }
                if (document.getElementById('dashboard').classList.contains('active')) {
                    updateStatistics(window.deviceData);
                    createDashboardCharts(window.deviceData);
                    updateDashboardTable(window.deviceData);
                }
            });
            
            // Formular zurücksetzen
            document.getElementById('add-device-form').reset();
        })
        .catch(error => {
            console.error('Fehler beim Hinzufügen des Geräts:', error);
            showNotification('Fehler', 'Gerät konnte nicht hinzugefügt werden', 'error');
        });
    }

    function generateAssetNumber() {
        // Generiere eine 8-stellige Asset-Nummer
        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        let result = '';
        for (let i = 0; i < 8; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function handleEditDevice(e) {
        e.preventDefault();
        const assetNumber = document.getElementById('edit-device-form').dataset.assetId;
        if (!assetNumber) {
            showNotification('Fehler', 'Keine Asset-Nummer gefunden', 'error');
            return;
        }

        const updatedDevice = {
            status: document.getElementById('edit-device-status').value,
            location: document.getElementById('edit-device-location').value,
            user: document.getElementById('edit-device-user').value,
            notes: document.getElementById('edit-device-notes').value,
        };

        fetch(`/api/devices/${assetNumber}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedDevice)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Netzwerkantwort war nicht ok');
            }
            return response.json();
        })
        .then(result => {
            showNotification('Erfolg', result.message, 'success');
            addConsoleMessage(`Gerät ${assetNumber} wurde aktualisiert`, 'success');
            document.getElementById('edit-device-modal').classList.remove('active');
            // Daten neu laden und UI aktualisieren
            loadDeviceData().then(() => {
                if (document.getElementById('devices').classList.contains('active')) {
                    updateDevicesTable(window.deviceData);
                }
            });
        })
        .catch(error => {
            console.error('Fehler beim Aktualisieren des Geräts:', error);
            showNotification('Fehler', 'Gerät konnte nicht aktualisiert werden', 'error');
        });
    }

    function exportData() {
        if (!window.deviceData || window.deviceData.length === 0) {
            alert('Keine Daten zum Exportieren verfügbar');
            return;
        }
        let csvContent = "Asset-Nummer,Hostname,Gerätetyp,Status,Seriennummer,Hersteller,Modell,Standort,Benutzer,Bemerkungen\n";
        window.deviceData.forEach(device => {
            const row = [
                device.assetNumber || '',
                device.hostname || '',
                device.deviceType || '',
                device.status || '',
                device.serialNumber || '',
                device.manufacturer || '',
                device.model || '',
                device.location || '',
                device.user || '',
                device.notes || ''
            ];
            csvContent += row.map(field => `"${field}"`).join(',') + '\n';
        });
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', 'ETK-Asset_Management.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        addConsoleMessage('Daten als CSV exportiert', 'info');
    }

    function resetSettings() {
        if (confirm('Alle Einstellungen auf Standardwerte zurücksetzen?')) {
            localStorage.removeItem('etkAssetSettings');
            loadSettings();
            applySettingsToUI(window.appSettings);
            showNotification('Erfolg', 'Einstellungen wurden zurückgesetzt', 'success');
        }
    }

    function clearCache() {
        if (confirm('Möchten Sie wirklich den Cache leeren? Dies entfernt alle gespeicherten Daten und Einstellungen.')) {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }
    }

    function downloadPSScript(e) {
        e.preventDefault();
        const link = document.createElement('a');
        link.setAttribute('href', 'File/ETK-Asset.ps1');
        link.setAttribute('download', 'ETK-Asset.ps1');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // --- MODERNE, DYNAMISCHE PDF-EXPORTFUNKTION (OPTIMIERT) ---
function downloadDevicePDF() {
    if (!currentDevice) {
        showNotification('Information', `Kein Gerät ausgewählt`, 'error');
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Farbschema für das moderne Design
    const colors = {
        primary: [255, 119, 0],      // Orange #FF7700
        primaryLight: [255, 152, 56], // Hellorange #FF9838
        secondary: [66, 153, 225],    // Blau #4299E1
        lightGray: [245, 245, 245],   // Sehr hellgrau #F5F5F5
        mediumGray: [220, 220, 220],  // Mittelgrau #DCDCDC
        darkGray: [100, 100, 100],    // Dunkelgrau #646464
        white: [255, 255, 255],       // Weiß
        black: [0, 0, 0],             // Schwarz
        success: [72, 187, 120],      // Grün #48BB78
        warning: [236, 201, 75],      // Gelb #ECC94B
        error: [245, 101, 101],      // Rot #F56565
        darkRed: [139, 0, 0],        // Dunkelrot #8B0000
        purple: [159, 122, 234]       // Lila #9F7AEA
    };

    // --- HILFSFUNKTIONEN FÜR DAS PDF-LAYOUT ---

    // Überprüft, ob genug Platz für ein Element mit einer bestimmten Höhe vorhanden ist.
    // Wenn nicht, wird eine neue Seite hinzugefügt.
    const checkPageBreak = (yPos, requiredHeight) => {
        // 267 ist die maximale y-Position, bevor der Footer (bei ~280) beginnt.
        if (yPos + requiredHeight > 267) {
            doc.addPage();
            addHeader();
            addFooter(doc.internal.getNumberOfPages());
            return 50; // y-Position nach dem Header auf der neuen Seite
        }
        return yPos;
    };

    const addHeader = () => {
        // Moderner Header mit Farbverlauf
        doc.setFillColor(...colors.primary);
        doc.rect(0, 0, 210, 40, 'F');
        
        doc.setTextColor(...colors.white);
        doc.setFontSize(24);
        doc.setFont(undefined, 'bold');
        doc.text('ETK Asset Management', 20, 20);
        
        doc.setFontSize(14);
        doc.setFont(undefined, 'normal');
        doc.text('Geräteinformationsbericht', 20, 30);

        doc.setFontSize(10);
        doc.text(new Date().toLocaleString('de-DE'), 190, 15, { align: 'right' });
    };

    const addFooter = (pageNumber) => {
        const pageCount = pageNumber || doc.internal.getNumberOfPages();
        doc.setDrawColor(...colors.mediumGray);
        doc.setLineWidth(0.5);
        doc.line(20, 280, 190, 280);
        
        doc.setTextColor(...colors.darkGray);
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text(`Seite ${pageCount} von ${pageCount}`, 105, 285, { align: 'center' });
        doc.text('© 2025 ETK-Asset Management - Vertraulich', 105, 290, { align: 'center' });
    };

    // Fügt ein transparentes Wasserzeichen hinzu
    const addWatermark = () => {
        doc.setGState(new doc.GState({ opacity: 0.07 })); // Setzt die Transparenz (0.0 - 1.0)
        doc.setTextColor(150, 150, 150); // Ein helles Grau
        doc.setFontSize(80);
        doc.setFont(undefined, 'bold');
        doc.text('ETK', 105, 150, { align: 'center', angle: 45 });
        doc.setGState(new doc.GState({ opacity: 1.0 })); // Setzt die Transparenz zurück
    };

    const addSection = (title, data, yPos) => {
        const sectionHeight = 17 + Object.keys(data).length * 8;
        yPos = checkPageBreak(yPos, sectionHeight);
        
        // Sektionsheader
        doc.setFillColor(...colors.primaryLight);
        doc.roundedRect(20, yPos - 5, 170, 12, 3, 3, 'F');
        doc.setTextColor(...colors.white);
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text(title, 25, yPos + 2);
        yPos += 17;

        // Daten als Schlüssel-Wert-Paare
        doc.setTextColor(...colors.black);
        doc.setFontSize(11);
        for (const [key, value] of Object.entries(data)) {
            if (value !== null && value !== undefined && value !== '') {
                doc.setFont(undefined, 'bold');
                doc.text(`${key}:`, 25, yPos);
                doc.setFont(undefined, 'normal');
                const valueText = String(value).length > 70 ? String(value).substring(0, 67) + '...' : String(value);
                doc.text(valueText, 60, yPos);
                yPos += 8;
            }
        }
        return yPos + 10; // Abstand nach der Sektion
    };

    const addTable = (title, headers, data, yPos) => {
        const tableHeight = 17 + 10 + data.length * 8;
        yPos = checkPageBreak(yPos, tableHeight);

        // Tabellen-Header
        doc.setFillColor(...colors.primaryLight);
        doc.roundedRect(20, yPos - 5, 170, 12, 3, 3, 'F');
        doc.setTextColor(...colors.white);
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text(title, 25, yPos + 2);
        yPos += 17;

        // Tabellen-Spaltenüberschriften
        doc.setFillColor(...colors.lightGray);
        doc.rect(20, yPos - 5, 170, 10, 'F');
        doc.setTextColor(...colors.black);
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        const colWidth = 170 / headers.length;
        headers.forEach((header, i) => {
            doc.text(header, 25 + colWidth * i, yPos);
        });
        yPos += 12;

        // Tabellenzeilen
        doc.setFont(undefined, 'normal');
        data.forEach(row => {
            row.forEach((cell, i) => {
                const cellText = String(cell || 'N/A').length > 20 ? String(cell || 'N/A').substring(0, 17) + '...' : String(cell || 'N/A');
                doc.text(cellText, 25 + colWidth * i, yPos);
            });
            yPos += 8;
        });
        return yPos + 10;
    };
    
    const addStatusBadge = (status, xPos, yPos) => {
        let badgeColor, statusText;
        switch (status) {
            case 'Verfügbar': badgeColor = colors.success; statusText = 'Verfügbar'; break;
            case 'in Betrieb': badgeColor = colors.error; statusText = 'In Betrieb'; break;
            case 'defekt': badgeColor = colors.darkRed; statusText = 'Defekt'; break;
            case 'in Reparatur': badgeColor = colors.warning; statusText = 'In Reparatur'; break;
            case 'ausgemustert': badgeColor = colors.purple; statusText = 'Ausgemustert'; break;
            default: badgeColor = colors.darkGray; statusText = status || 'Unbekannt';
        }
        doc.setFillColor(...badgeColor);
        doc.roundedRect(xPos, yPos - 5, doc.getTextWidth(statusText) + 10, 8, 2, 2, 'F');
        doc.setTextColor(...colors.white);
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text(statusText, xPos + 5, yPos);
    };

    // --- DATENVERARBEITUNG UND PDF-ERSTELLUNG ---

    // Start des PDF-Dokuments
    addHeader();
    let yPosition = 60;

    // Titel und Status
    doc.setTextColor(...colors.black);
    doc.setFontSize(18);
    doc.setFont(undefined, 'bold');
    doc.text(`${currentDevice.assetNumber || 'Unbekannt'} - ${currentDevice.hostname || 'Unbekannt'}`, 20, yPosition);
    yPosition += 10;
    if (currentDevice.status) {
        addStatusBadge(currentDevice.status, 20, yPosition);
        yPosition += 15;
    }

    // Daten kategorisieren und aufbereiten
    const sections = {
        'Allgemeine Informationen': {
            'Asset-Nummer': currentDevice.assetNumber,
            'Hostname': currentDevice.hostname,
            'Gerätetyp': currentDevice.deviceType,
            'Seriennummer': currentDevice.serialNumber,
            'Hersteller': currentDevice.manufacturer,
            'Modell': currentDevice.model,
            'Standort': currentDevice.location,
            'Benutzer': currentDevice.user,
            'Kaufdatum': currentDevice.purchaseDate ? new Date(currentDevice.purchaseDate).toLocaleDateString('de-DE') : null,
            'Garantie bis': currentDevice.warrantyExpiry ? new Date(currentDevice.warrantyExpiry).toLocaleDateString('de-DE') : null,
            'Bemerkungen': currentDevice.notes
        },
        'Hardware & OS': {
            'CPU': currentDevice.cpu,
            'RAM': currentDevice.ramGB ? `${currentDevice.ramGB} GB` : null,
            'Kerne': currentDevice.cores,
            'Prozessoren': currentDevice.logicalProc,
            'Betriebssystem': currentDevice.os,
            'OS-Version': currentDevice.osVersion,
            'OS-Architektur': currentDevice.osArch,
            'BIOS-Version': currentDevice.biosVersion
        },
        'Server-Details': {
            'Rack': currentDevice.rack,
            'Slot': currentDevice.slot,
            'Betriebsklasse': currentDevice.operationClass,
            'Verantwortlicher (IT)': currentDevice.itResponsible
        },
        'Netzwerkgerät-Details': {
            'Firmware-Version': currentDevice.firmware,
            'Anzahl Ports': currentDevice.portCount,
            'Standort im Netzwerk': currentDevice.networkLocation
        },
        'Peripherie-Details': {
            'Anschluss': currentDevice.connection,
            'Auflösung / Funktion': currentDevice.resolution
        }
    };

    // Abschnitte mit einfachen Daten rendern
    for (const [title, data] of Object.entries(sections)) {
        const filteredData = Object.fromEntries(Object.entries(data).filter(([_, v]) => v != null));
        if (Object.keys(filteredData).length > 0) {
            yPosition = addSection(title, filteredData, yPosition);
        }
    }
    
    // Tabellen für komplexe Daten (Arrays) rendern
    if (currentDevice.storage && currentDevice.storage.length > 0) {
        const storageData = currentDevice.storage.map(s => [
            s.type || 'N/A',
            s.size ? `${s.size} GB` : 'N/A',
            s.interface || 'N/A'
        ]);
        yPosition = addTable('Speicher', ['Typ', 'Größe', 'Schnittstelle'], storageData, yPosition);
    }

    if (currentDevice.network && currentDevice.network.length > 0) {
        const networkData = currentDevice.network.map(n => [
            n.Description || 'N/A',
            n.IPAddress || 'N/A',
            n.MACAddress || 'N/A',
            n.SubnetMask || 'N/A'
        ]);
        yPosition = addTable('Netzwerkadapter', ['Beschreibung', 'IP-Adresse', 'MAC-Adresse', 'Subnetzmaske'], networkData, yPosition);
    }

    if (currentDevice.gpu && currentDevice.gpu.length > 0) {
        const gpuData = currentDevice.gpu.map(g => [
            g.Name || 'N/A',
            g.AdapterRAMGB ? `${g.AdapterRAMGB} GB` : 'N/A',
            g.DriverVersion || 'N/A'
        ]);
        yPosition = addTable('Grafikkarten', ['Name', 'Speicher', 'Treiber-Version'], gpuData, yPosition);
    }
    
    if (currentDevice.drives) {
        if (currentDevice.drives.localDrives && currentDevice.drives.localDrives.length > 0) {
            const localDrivesData = currentDevice.drives.localDrives.map(d => [
                d.DeviceID || 'N/A',
                d.VolumeName || 'N/A',
                d.SizeGB ? `${d.SizeGB} GB` : 'N/A',
                d.FreeGB ? `${d.FreeGB} GB` : 'N/A',
                d.FileSystem || 'N/A'
            ]);
            yPosition = addTable('Lokale Laufwerke', ['Laufwerk', 'Name', 'Gesamt', 'Frei', 'Dateisystem'], localDrivesData, yPosition);
        }
        if (currentDevice.drives.networkDrives && currentDevice.drives.networkDrives.length > 0) {
            const networkDrivesData = currentDevice.drives.networkDrives.map(d => [
                d.DeviceID || 'N/A',
                d.VolumeName || 'N/A',
                d.ProviderName || 'N/A'
            ]);
            yPosition = addTable('Netzlaufwerke', ['Laufwerk', 'Name', 'Anbieter'], networkDrivesData, yPosition);
        }
        if (currentDevice.drives.cloudDrives && currentDevice.drives.cloudDrives.length > 0) {
            const cloudDrivesData = currentDevice.drives.cloudDrives.map(d => [
                d.CloudProvider || 'N/A',
                d.SyncStatus || 'N/A',
                d.AccountEmail || 'N/A'
            ]);
            yPosition = addTable('Cloud-Laufwerke', ['Anbieter', 'Sync-Status', 'Konto'], cloudDrivesData, yPosition);
        }
    }

    // Footer und Wasserzeichen auf allen Seiten hinzufügen
    const pageCount = doc.internal.getNumberOfPages();
    for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        addWatermark();
        addFooter(i);
    }

    // PDF speichern
    doc.save(`Gerätedetails_${currentDevice.assetNumber || 'Unbekannt'}_${currentDevice.hostname || 'Unbekannt'}_${new Date().toISOString().slice(0, 10)}.pdf`);
    showNotification('Erfolg', 'PDF wurde erfolgreich erstellt', 'success');
}

    // Ersetzen Sie die bestehende deleteDeviceWithPassword-Funktion durch diese:
    function deleteDeviceWithPassword() {
        if (!currentDevice) return;
        
        // Setze den Gerätenamen im Modal
        document.getElementById('device-to-delete-name').textContent = 
            `${currentDevice.assetNumber || 'Unbekannt'} - ${currentDevice.hostname || 'Unbekannt'}`;
        
        // Zeige das Passwort-Modal
        document.getElementById('password-modal').classList.add('active');
        
        // Fokus auf das Passwortfeld setzen
        setTimeout(() => {
            document.getElementById('delete-password-input').focus();
        }, 300);
    }

    // Fügen Sie diese Event-Listener am Ende Ihres setupEventListeners-Blocks hinzu:
    // Password Modal Event Listeners
    document.getElementById('password-modal-close-btn').addEventListener('click', () => {
        document.getElementById('password-modal').classList.remove('active');
        document.getElementById('delete-password-input').value = '';
    });

    document.getElementById('password-cancel-btn').addEventListener('click', () => {
        document.getElementById('password-modal').classList.remove('active');
        document.getElementById('delete-password-input').value = '';
    });

    document.getElementById('password-confirm-btn').addEventListener('click', () => {
        const password = document.getElementById('delete-password-input').value;
        
        if (password === 'ETKN2025!') {
            // Schließe das Passwort-Modal
            document.getElementById('password-modal').classList.remove('active');
            document.getElementById('delete-password-input').value = '';
            
            // Führe die Löschoperation durch
            fetch(`/api/devices/${currentDevice.assetNumber}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Löschen des Geräts');
                }
                return response.json();
            })
            .then(result => {
                showNotification('Erfolg', result.message, 'success');
                addConsoleMessage(`Gerät ${currentDevice.assetNumber} wurde gelöscht`, 'success');
                document.getElementById('device-modal').classList.remove('active');
                
                // Daten neu laden und UI aktualisieren
                loadDeviceData().then(() => {
                    if (document.getElementById('devices').classList.contains('active')) {
                        updateDevicesTable(window.deviceData);
                    }
                });
            })
            .catch(error => {
                console.error('Fehler:', error);
                showNotification('Fehler', 'Gerät konnte nicht gelöscht werden', 'error');
            });
        } else {
            // Zeige eine Fehlermeldung im Modal
            const passwordInput = document.getElementById('delete-password-input');
            passwordInput.style.borderColor = 'var(--danger)';
            passwordInput.setAttribute('placeholder', 'Falsches Passwort!');
            
            // Entferne die Fehlermarkierung nach 2 Sekunden
            setTimeout(() => {
                passwordInput.style.borderColor = '';
                passwordInput.setAttribute('placeholder', 'Passwort eingeben');
            }, 2000);
            
            // Leere das Eingabefeld
            passwordInput.value = '';
            passwordInput.focus();
        }
    });

    // Passwort-Sichtbarkeit umschalten
    document.getElementById('password-toggle-btn').addEventListener('click', function() {
        const passwordInput = document.getElementById('delete-password-input');
        const icon = this.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    });

    // Schließe das Modal, wenn außerhalb geklickt wird
    document.getElementById('password-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
            document.getElementById('delete-password-input').value = '';
        }
    });

    function clearConsole() {
        document.getElementById('console-content').innerHTML = '';
        consoleLogData = [];
        localStorage.removeItem('consoleLog');
        updateLogStatistics();
        addConsoleMessage('Console geleert', 'info');
    }

    function refreshConsole() {
        displayConsoleLogs();
        addConsoleMessage('Console aktualisiert', 'info');
    }

    function downloadConsoleLog() {
        let logText = '';
        consoleLogData.forEach(log => {
            const date = new Date(log.timestamp);
            logText += `[${date.toLocaleString('de-DE')}] ${log.type.toUpperCase()}: ${log.message}\n`;
        });
        const blob = new Blob([logText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `console-log-${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        addConsoleMessage('Console-Log wurde heruntergeladen', 'success');
    }

    function updateInfoCard() {
        document.getElementById('last-update-time').textContent = new Date().toLocaleString('de-DE');
        document.getElementById('device-count').textContent = window.deviceData ? window.deviceData.length : 0;
        // Speicherverbrauch könnte hier berechnet werden
    }

    // --- HILFSFUNKTIONEN ---

    function showNotification(title, message, type = 'info') {
        // FIX: Überprüfe die Benachrichtigungseinstellung, bevor eine Benachrichtigung angezeigt wird.
        if (!window.appSettings.notifications) {
            return;
        }

        const container = document.getElementById('notification-container');
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;

        const iconMap = { success: 'fa-check-circle', error: 'fa-exclamation-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' };

        notification.innerHTML = `
            <i class="fas ${iconMap[type]} notification-icon"></i>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
            <button class="notification-close">&times;</button>
        `;

        container.appendChild(notification);
        setTimeout(() => notification.classList.add('show'), 10);

        const closeBtn = notification.querySelector('.notification-close');
        closeBtn.addEventListener('click', () => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        });

        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }
        }, 5000);
    }

    function toggleCompactMode(isCompact) {
        document.body.classList.toggle('compact-mode', isCompact);
        if (document.getElementById('devices').classList.contains('active') && window.deviceData) {
            updateDevicesTable(window.deviceData);
        }
    }

    function startAutoRefresh(interval) {
        stopAutoRefresh();
        autoRefreshInterval = setInterval(() => {
            if (document.getElementById('dashboard').classList.contains('active')) {
                loadDeviceData().then(() => {
                    if (window.deviceData) {
                        updateStatistics(window.deviceData);
                        createDashboardCharts(window.deviceData);
                        updateDashboardTable(window.deviceData);
                    }
                });
            }
        }, interval);
    }

    function stopAutoRefresh() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
    }

    // --- START DER ANWENDUNG ---
    initApp();

    // Starte die Uhr
    setInterval(() => {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleString('de-DE');
    }, 1000);

    // Bevor die Seite geschlossen wird, EventSource-Verbindung schließen (falls vorhanden)
    window.addEventListener('beforeunload', () => {
        if (eventSource) {
            eventSource.close();
        }
    });
});
</script>
</html>